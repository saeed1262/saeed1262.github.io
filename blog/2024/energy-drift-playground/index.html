<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Energy Drift Playground ‚Äî Simple Pendulum | Saeed Ghorbani</title> <meta name="author" content="Saeed Ghorbani"/> <meta name="description" content="Interactive exploration of numerical integration schemes and energy conservation in physics simulations. Master symplectic methods, stability analysis, and the mathematical foundations of computational physics."/> <meta name="keywords" content="machine learning, computer vision, computer graphics, computer animation, human motion modeling, probabilistic models, deep learning, research scientist, Amazon Games, motion synthesis, pose estimation, gesture generation"/> <meta property="og:site_name" content="Saeed Ghorbani"/> <meta property="og:type" content="website"/> <meta property="og:title" content="Saeed Ghorbani | Energy Drift Playground ‚Äî Simple Pendulum"/> <meta property="og:url" content="https://saeed1262.github.io/blog/2024/energy-drift-playground/"/> <meta property="og:description" content="Interactive exploration of numerical integration schemes and energy conservation in physics simulations. Master symplectic methods, stability analysis, and the mathematical foundations of computational physics."/> <meta property="og:image" content="/assets/img/saeed.jpg"/> <meta property="og:locale" content="en"/> <meta name="twitter:card" content="summary"/> <meta name="twitter:title" content="Energy Drift Playground ‚Äî Simple Pendulum"/> <meta name="twitter:description" content="Interactive exploration of numerical integration schemes and energy conservation in physics simulations. Master symplectic methods, stability analysis, and the mathematical foundations of computational physics."/> <meta name="twitter:image" content="/assets/img/saeed.jpg"/> <meta name="twitter:site" content="@SaGhorbani"/> <meta name="twitter:creator" content="@SaGhorbani"/> <script type="application/ld+json">
      {
        "author":
        {
          "@type": "Person",
          "name": "Saeed  Ghorbani"
        },
        "url": "https://saeed1262.github.io/blog/2024/energy-drift-playground/",
        "@type": "WebSite",
        "description": "Interactive exploration of numerical integration schemes and energy conservation in physics simulations. Master symplectic methods, stability analysis, and the mathematical foundations of computational physics.",
        "headline": "Energy Drift Playground ‚Äî Simple Pendulum",
        "sameAs": ["https://scholar.google.com/citations?user=JFRY_g8AAAAJ&hl", "https://github.com/saeed1262", "https://www.linkedin.com/in/saeed-ghorbani-ba4872136", "https://twitter.com/SaGhorbani"],
        "name": "Saeed  Ghorbani",
        "@context": "https://schema.org"
      }
    </script> <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin> <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> <link rel="dns-prefetch" href="//www.google-analytics.com"> <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"> <meta name="theme-color" content="#6c63ff"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"> <meta name="msapplication-TileColor" content="#6c63ff"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="preload" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Slab:wght@100;300;400;500;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Slab:wght@100;300;400;500;700&display=swap"></noscript> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="/assets/img/fav.png"/> <link rel="preload" href="/assets/css/main.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="/assets/css/main.css"></noscript> <link rel="canonical" href="https://saeed1262.github.io/blog/2024/energy-drift-playground/"> <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://saeed1262.github.io/">Saeed Ghorbani</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Submenus</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/projects/">projects</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Energy Drift Playground ‚Äî Simple Pendulum</h1> <p class="post-meta">August 24, 2024</p> <p class="post-tags"> <a href="/blog/2024"> <i class="fas fa-calendar fa-sm"></i> 2024 </a> ¬† ¬∑ ¬† <a href="/blog/tag/energy-drift"> <i class="fas fa-hashtag fa-sm"></i> energy-drift</a> ¬† <a href="/blog/tag/physics"> <i class="fas fa-hashtag fa-sm"></i> physics</a> ¬† <a href="/blog/tag/simulation"> <i class="fas fa-hashtag fa-sm"></i> simulation</a> ¬† <a href="/blog/tag/numerical-methods"> <i class="fas fa-hashtag fa-sm"></i> numerical-methods</a> ¬† <a href="/blog/tag/energy-conservation"> <i class="fas fa-hashtag fa-sm"></i> energy-conservation</a> ¬† <a href="/blog/tag/symplectic-integrators"> <i class="fas fa-hashtag fa-sm"></i> symplectic-integrators</a> ¬† <a href="/blog/tag/computational-physics"> <i class="fas fa-hashtag fa-sm"></i> computational-physics</a> ¬† ¬† ¬∑ ¬† <a href="/blog/category/blog"> <i class="fas fa-tag fa-sm"></i> blog</a> ¬† </p> </header> <article class="post-content"> <h2 id="the-foundation-of-computational-physics">The Foundation of Computational Physics</h2> <p>In the realm of computational physics, one fundamental challenge towers above all others: how do we preserve the essential properties of physical systems when translating continuous mathematics into discrete computations? This question lies at the heart of every physics simulation, from climate models predicting global warming to spacecraft navigation systems guiding interplanetary missions.</p> <p><strong>Energy drift</strong> represents perhaps the most critical manifestation of numerical error in conservative systems. When simulating a frictionless pendulum, total mechanical energy must remain constant for all time‚Äîthis is not merely a numerical preference, but a fundamental law of physics. Yet many integration schemes systematically violate this conservation, leading to completely unphysical behavior that can invalidate years of computational work.</p> <p>What if we could visualize this phenomenon in real-time? What if we could <em>feel</em> how different mathematical approaches either preserve or destroy the fundamental structure of physical reality?</p> <h2 id="the-mathematical-foundation-of-conservative-systems">The Mathematical Foundation of Conservative Systems</h2> <h3 id="hamiltonian-mechanics-and-phase-space">Hamiltonian Mechanics and Phase Space</h3> <p>A pendulum with length \(L\) and mass \(m\) under gravity \(g\) is governed by the Hamiltonian:</p> \[H(q, p) = \frac{p^2}{2mL^2} + mgL(1 - \cos q)\] <p>where \(q = \theta\) is the angular position and \(p = mL^2\dot{\theta}\) is the canonical momentum.</p> <p>Hamilton‚Äôs equations provide the time evolution:</p> \[\frac{dq}{dt} = \frac{\partial H}{\partial p} = \frac{p}{mL^2}\] \[\frac{dp}{dt} = -\frac{\partial H}{\partial q} = -mgL\sin q\] <p>This formulation reveals the <strong>symplectic structure</strong> underlying all Hamiltonian systems‚Äîa geometric property that governs how phase space volumes evolve over time.</p> <h3 id="liouvilles-theorem-and-phase-space-conservation">Liouville‚Äôs Theorem and Phase Space Conservation</h3> <p>Liouville‚Äôs theorem states that Hamiltonian flow preserves phase space volume:</p> \[\frac{d}{dt}\int_{\Omega(t)} dq \, dp = 0\] <p>This fundamental result has profound implications for numerical integration: <strong>any integration scheme that preserves phase space volume will maintain bounded energy errors over arbitrarily long time scales</strong>.</p> <h3 id="the-symplectic-condition">The Symplectic Condition</h3> <p>A transformation \((q_n, p_n) \rightarrow (q_{n+1}, p_{n+1})\) is symplectic if it preserves the symplectic form:</p> \[dp_{n+1} \wedge dq_{n+1} = dp_n \wedge dq_n\] <p>Equivalently, if we write the transformation as \(\mathbf{z}_{n+1} = \mathbf{M}\mathbf{z}_n\) where \(\mathbf{z} = (q, p)^T\), then \(\mathbf{M}\) must satisfy:</p> \[\mathbf{M}^T \mathbf{J} \mathbf{M} = \mathbf{J}\] <p>where \(\mathbf{J} = \begin{pmatrix} 0 &amp; 1 \\ -1 &amp; 0 \end{pmatrix}\) is the symplectic matrix.</p> <h2 id="visualizing-phase-space-the-geometric-perspective">Visualizing Phase Space: The Geometric Perspective</h2> <p>Before exploring individual integration methods, we must understand how they behave in <strong>phase space</strong>‚Äîthe natural coordinate system for Hamiltonian dynamics.</p> <h3 id="phase-space-trajectories-and-conservation">Phase Space Trajectories and Conservation</h3> <p>In phase space, each point represents a complete state $(\theta, \omega)$ of the pendulum. As time evolves, the system traces out a trajectory in this space. For the conservative pendulum, these trajectories have remarkable properties:</p> <p><strong>Energy Conservation as Geometric Constraint:</strong> Each trajectory lies on a curve of constant energy: \(H(\theta, \omega) = \frac{1}{2}\omega^2 + \frac{g}{L}(1 - \cos\theta) = E_0\)</p> <p><strong>Three Regimes of Motion:</strong></p> <ul> <li> <strong>Small oscillations</strong> (\(E_0 &lt; 2g/L\)): Closed elliptical orbits around \((\theta, \omega) = (0, 0)\)</li> <li> <strong>Large oscillations</strong> (\(E_0 &gt; 2g/L\)): Open trajectories representing continuous rotation</li> <li> <strong>Separatrix</strong> (\(E_0 = 2g/L\)): The critical boundary between oscillation and rotation</li> </ul> <div id="phase-space-theory" style="max-width: 100%; margin: 30px 0;"> <div style="background-color: var(--global-card-bg-color); border-radius: 12px; padding: 25px; color: var(--global-text-color); border: 1px solid var(--global-border-color); box-shadow: var(--global-box-shadow-lg);"> <h4 style="margin: 0 0 20px 0; color: var(--global-theme-color);">Interactive Phase Space Explorer</h4> <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;"> <div> <h5 style="color: var(--global-heading-color);">Theoretical Phase Portrait</h5> <canvas id="theory-phase-canvas" width="350" height="350" style="background-color: var(--global-bg-color-secondary); border-radius: 8px; width: 100%; border: 1px solid var(--global-border-color);"></canvas> <div style="margin-top: 10px; font-size: 12px;"> <div style="color: var(--global-text-color);">Click on the phase space to set initial conditions!</div> <div style="color: #3b82f6;">Current Energy: <span id="theory-energy">2.45</span> J</div> </div> </div> <div> <h5 style="color: var(--global-heading-color);">Method Comparison</h5> <canvas id="comparison-phase-canvas" width="350" height="350" style="background-color: var(--global-bg-color-secondary); border-radius: 8px; width: 100%; border: 1px solid var(--global-border-color);"></canvas> <div style="margin-top: 10px;"> <label style="color: var(--global-text-color);">Integration Method: </label> <select id="phase-method-select" style="background-color: var(--global-card-bg-color); color: var(--global-text-color); border: 1px solid var(--global-border-color); padding: 5px; border-radius: 4px;"> <option value="symplectic">Symplectic Euler</option> <option value="euler">Explicit Euler</option> <option value="verlet">Velocity Verlet</option> <option value="rk4">RK4</option> <option value="all">All Methods</option> </select> </div> </div> </div> <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;"> <div> <h5 style="color: var(--global-heading-color);">Simulation Parameters</h5> <div style="margin-bottom: 10px;"> <label style="color: var(--global-text-color);">Time Step: <span id="phase-timestep">5</span> ms</label> <input type="range" id="phase-timestep-slider" min="1" max="20" value="5" style="width: 100%; accent-color: var(--global-theme-color);"> </div> <div style="margin-bottom: 10px;"> <label style="color: var(--global-text-color);">Simulation Speed: <span id="phase-speed">1</span>x</label> <input type="range" id="phase-speed-slider" min="1" max="10" value="1" style="width: 100%; accent-color: var(--global-theme-color);"> </div> </div> <div> <h5 style="color: var(--global-heading-color);">Current State</h5> <div style="font-size: 12px;"> <div style="color: var(--global-text-color);">Time: <span id="phase-time">0.00</span>s</div> <div style="color: var(--global-text-color);">Œ∏: <span id="phase-theta">0.785</span> rad</div> <div style="color: var(--global-text-color);">œâ: <span id="phase-omega">0.000</span> rad/s</div> <div style="color: #ef4444; margin-top: 5px;">Energy Error: <span id="phase-energy-error">0.00</span>%</div> </div> </div> </div> <div style="text-align: center;"> <button id="phase-play-pause" style="background: var(--global-gradient-primary); border: none; color: white; padding: 8px 16px; border-radius: 6px; margin-right: 10px; font-weight: 600; cursor: pointer;">Pause</button> <button id="phase-reset" style="background: #FF6B6B; border: none; color: white; padding: 8px 16px; border-radius: 6px; margin-right: 10px; font-weight: 600; cursor: pointer;">Reset</button> <button id="phase-clear" style="background: #6B7280; border: none; color: white; padding: 8px 16px; border-radius: 6px; font-weight: 600; cursor: pointer;">Clear Trails</button> </div> </div> </div> <h3 id="the-symplectic-advantage-geometric-structure-preservation">The Symplectic Advantage: Geometric Structure Preservation</h3> <p>The key insight is that <strong>symplectic methods preserve the geometric structure of phase space</strong>, while non-symplectic methods systematically distort it:</p> <p><strong>Explicit Euler:</strong> Non-symplectic transformation causes trajectories to spiral outward, violating energy conservation.</p> <p><strong>Symplectic Euler:</strong> Despite first-order accuracy, preserves the topological structure of phase space, keeping trajectories on correct energy surfaces.</p> <p><strong>Velocity Verlet:</strong> Combines symplectic structure preservation with second-order accuracy, producing nearly perfect phase space trajectories.</p> <p><strong>RK4:</strong> High local accuracy but lacks symplectic structure, leading to slow drift off energy surfaces.</p> <h2 id="the-critical-challenge-long-term-stability-vs-local-accuracy">The Critical Challenge: Long-Term Stability vs. Local Accuracy</h2> <p>The naive approach to numerical integration prioritizes <strong>local truncation error</strong>‚Äîhow well each individual step approximates the true solution. However, for conservative systems, this focus can be catastrophically misguided.</p> <p>Consider two fundamental questions:</p> <ol> <li>Should we choose a method with fourth-order local accuracy that allows energy to drift systematically?</li> <li>Or should we prefer a first-order method that maintains perfect energy conservation structure?</li> </ol> <p>For short simulations, local accuracy dominates. For long-term evolution‚Äîclimate modeling, orbital mechanics, molecular dynamics‚Äîgeometric structure preservation becomes paramount.</p> <h2 id="interactive-laboratory-four-integration-paradigms">Interactive Laboratory: Four Integration Paradigms</h2> <p>The simple pendulum provides an ideal testbed because:</p> <ul> <li> <strong>Conservative system</strong>: Energy conservation is mathematically guaranteed</li> <li> <strong>Nonlinear dynamics</strong>: Small errors can compound exponentially</li> <li> <strong>Well-understood physics</strong>: We know the ground truth behavior</li> <li> <strong>Rich phase space</strong>: Exhibits libration, circulation, and separatrix dynamics</li> </ul> <h3 id="method-1-explicit-euler---the-unstable-baseline">Method 1: Explicit Euler - The Unstable Baseline</h3> <p>The <strong>Explicit Euler</strong> method represents the most straightforward approach to numerical integration:</p> <p><strong>Algorithm:</strong> \(\omega_{n+1} = \omega_n + h \cdot f(\theta_n, \omega_n)\) \(\theta_{n+1} = \theta_n + h \cdot \omega_n\)</p> <p>where \(f(\theta, \omega) = -\frac{g}{L}\sin(\theta)\) is the angular acceleration.</p> <p><strong>Mathematical Analysis:</strong></p> <ul> <li> <strong>Order of accuracy</strong>: \(O(h)\)</li> <li> <strong>Stability</strong>: Conditionally stable with severe restrictions on \(h\)</li> <li> <strong>Energy behavior</strong>: Systematic energy growth due to the use of ‚Äústale‚Äù velocity information</li> <li> <strong>Phase space</strong>: Non-symplectic transformation that violates Liouville‚Äôs theorem</li> </ul> <p><strong>The Fundamental Flaw:</strong> Explicit Euler uses the velocity at time \(t_n\) to update position to time \(t_{n+1}\), while using the acceleration at time \(t_n\) to update velocity to time \(t_{n+1}\). This temporal mismatch systematically overestimates kinetic energy, leading to the characteristic exponential energy growth.</p> <div id="euler-demo" style="max-width: 100%; margin: 30px 0; box-shadow: var(--global-box-shadow-lg);"> <div style="background-color: var(--global-card-bg-color); border-radius: 12px; padding: 30px; color: var(--global-text-color); border: 1px solid var(--global-border-color);"> <div style="display: flex; align-items: center; margin-bottom: 25px;"> <div style="width: 4px; height: 30px; background: linear-gradient(to bottom, #ef4444, #dc2626); border-radius: 2px; margin-right: 15px;"></div> <h4 style="margin: 0; color: #ef4444; font-size: 1.4em; font-weight: 600;">Explicit Euler Method</h4> <span style="margin-left: auto; background: rgba(239, 68, 68, 0.15); color: #ef4444; padding: 4px 12px; border-radius: 20px; font-size: 0.8em; font-weight: 500;">Energy Growth</span> </div> <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;"> <div style="background-color: var(--global-bg-color-secondary); border-radius: 12px; padding: 20px; border: 1px solid var(--global-border-color);"> <h5 style="margin: 0 0 15px 0; color: var(--global-heading-color); font-size: 1.1em;">Pendulum Animation</h5> <div style="position: relative; border-radius: 10px; overflow: hidden; box-shadow: var(--global-box-shadow-sm);"> <canvas id="euler-canvas" width="280" height="280" style="background-color: var(--global-bg-color-secondary); width: 100%; display: block;"></canvas> </div> </div> <div style="background-color: var(--global-bg-color-secondary); border-radius: 12px; padding: 20px; border: 1px solid var(--global-border-color);"> <h5 style="margin: 0 0 15px 0; color: var(--global-heading-color); font-size: 1.1em;">Energy Over Time</h5> <div style="position: relative; border-radius: 10px; overflow: hidden; box-shadow: var(--global-box-shadow-sm);"> <canvas id="euler-energy" width="280" height="280" style="background-color: var(--global-bg-color-secondary); width: 100%; display: block;"></canvas> </div> </div> </div> <div style="display: flex; align-items: center; justify-content: space-between; background-color: var(--global-bg-color-secondary); border-radius: 10px; padding: 15px; border: 1px solid var(--global-border-color);"> <div style="display: flex; align-items: center; gap: 15px;"> <label style="color: var(--global-text-color); font-weight: 500;">Time Step: <span id="euler-timestep" style="color: #ef4444; font-weight: 600;">10</span> ms</label> <input type="range" id="euler-slider" min="1" max="50" value="10" style="width: 200px; accent-color: #ef4444;"> </div> <div style="display: flex; gap: 10px;"> <button id="euler-play-pause" style="background: linear-gradient(135deg, #10b981, #059669); border: none; color: white; padding: 8px 16px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: var(--global-box-shadow-md);">Pause</button> <button id="euler-reset" style="background: linear-gradient(135deg, #ef4444, #dc2626); border: none; color: white; padding: 8px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: var(--global-box-shadow-md);">Reset</button> </div> </div> <div style="margin-top: 15px; text-align: center; font-size: 14px;"> Energy Error: <span id="euler-error" style="background: rgba(239, 68, 68, 0.2); color: #ef4444; padding: 4px 12px; border-radius: 20px; font-weight: 600;">0.00%</span> </div> </div> </div> <h3 id="method-2-symplectic-euler---the-geometric-insight">Method 2: Symplectic Euler - The Geometric Insight</h3> <p><strong>Symplectic Euler</strong> makes a subtle but revolutionary change: update momentum first, then use the updated momentum to advance position.</p> <p><strong>Algorithm:</strong> \(p_{n+1} = p_n + h \cdot F(q_n)\) \(q_{n+1} = q_n + h \cdot \frac{p_{n+1}}{m}\)</p> <p>For the pendulum: \(\omega_{n+1} = \omega_n + h \cdot \left(-\frac{g}{L}\sin(\theta_n)\right)\), then \(\theta_{n+1} = \theta_n + h \cdot \omega_{n+1}\)</p> <p><strong>Symplectic Structure Preservation:</strong> For the linearized harmonic oscillator, the transformation matrix for symplectic Euler is: \(\mathbf{M} = \begin{pmatrix} 1 - h^2 \omega_0^2 &amp; h \\ - h \omega_0^2 &amp; 1 \end{pmatrix}\)</p> <p>One can verify that \(\det(\mathbf{M}) = 1\), ensuring the method is symplectic (area-preserving in phase space).</p> <p><strong>Key Properties:</strong></p> <ul> <li> <strong>Order of accuracy</strong>: Still \(O(h)\) locally</li> <li> <strong>Global behavior</strong>: Energy oscillates with bounded amplitude</li> <li> <strong>Reversibility</strong>: Time-reversible integration</li> <li> <strong>Long-term stability</strong>: No secular drift in energy</li> </ul> <p><strong>The Geometric Miracle:</strong> Despite having the same local accuracy as Explicit Euler, Symplectic Euler captures the essential geometric structure of Hamiltonian flow. This leads to fundamentally different long-term behavior‚Äîenergy remains bounded rather than growing exponentially.</p> <div id="symplectic-demo" style="max-width: 100%; margin: 30px 0; box-shadow: var(--global-box-shadow-lg);"> <div style="background-color: var(--global-card-bg-color); border-radius: 12px; padding: 30px; color: var(--global-text-color); border: 1px solid var(--global-border-color);"> <div style="display: flex; align-items: center; margin-bottom: 25px;"> <div style="width: 4px; height: 30px; background: linear-gradient(to bottom, #22c55e, #16a34a); border-radius: 2px; margin-right: 15px;"></div> <h4 style="margin: 0; color: #22c55e; font-size: 1.4em; font-weight: 600;">Symplectic Euler Method</h4> <span style="margin-left: auto; background: rgba(34, 197, 94, 0.15); color: #22c55e; padding: 4px 12px; border-radius: 20px; font-size: 0.8em; font-weight: 500;">Energy Conservation</span> </div> <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;"> <div style="background-color: var(--global-bg-color-secondary); border-radius: 12px; padding: 20px; border: 1px solid var(--global-border-color);"> <h5 style="margin: 0 0 15px 0; color: var(--global-heading-color); font-size: 1.1em;">Pendulum Animation</h5> <div style="position: relative; border-radius: 10px; overflow: hidden; box-shadow: var(--global-box-shadow-sm);"> <canvas id="symplectic-canvas" width="280" height="280" style="background-color: var(--global-bg-color-secondary); width: 100%; display: block;"></canvas> </div> </div> <div style="background-color: var(--global-bg-color-secondary); border-radius: 12px; padding: 20px; border: 1px solid var(--global-border-color);"> <h5 style="margin: 0 0 15px 0; color: var(--global-heading-color); font-size: 1.1em;">Energy Over Time</h5> <div style="position: relative; border-radius: 10px; overflow: hidden; box-shadow: var(--global-box-shadow-sm);"> <canvas id="symplectic-energy" width="280" height="280" style="background-color: var(--global-bg-color-secondary); width: 100%; display: block;"></canvas> </div> </div> </div> <div style="display: flex; align-items: center; justify-content: space-between; background-color: var(--global-bg-color-secondary); border-radius: 10px; padding: 15px; border: 1px solid var(--global-border-color);"> <div style="display: flex; align-items: center; gap: 15px;"> <label style="color: var(--global-text-color); font-weight: 500;">Time Step: <span id="symplectic-timestep" style="color: #22c55e; font-weight: 600;">10</span> ms</label> <input type="range" id="symplectic-slider" min="1" max="50" value="10" style="width: 200px; accent-color: #22c55e;"> </div> <div style="display: flex; gap: 10px;"> <button id="symplectic-play-pause" style="background: linear-gradient(135deg, #10b981, #059669); border: none; color: white; padding: 8px 16px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: var(--global-box-shadow-md);">Pause</button> <button id="symplectic-reset" style="background: linear-gradient(135deg, #22c55e, #16a34a); border: none; color: white; padding: 8px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: var(--global-box-shadow-md);">Reset</button> </div> </div> <div style="margin-top: 15px; text-align: center; font-size: 14px;"> Energy Error: <span id="symplectic-error" style="background: rgba(34, 197, 94, 0.2); color: #22c55e; padding: 4px 12px; border-radius: 20px; font-weight: 600;">0.00%</span> </div> </div> </div> <h3 id="method-3-velocity-verlet---the-optimal-balance">Method 3: Velocity Verlet - The Optimal Balance</h3> <p><strong>Velocity Verlet</strong> (also known as Leapfrog) combines symplectic structure with higher-order accuracy through a three-stage process:</p> <p><strong>Algorithm:</strong> \(v_{n+1/2} = v_n + \frac{h}{2} a(x_n)\) \(x_{n+1} = x_n + h \cdot v_{n+1/2}\) \(v_{n+1} = v_{n+1/2} + \frac{h}{2} a(x_{n+1})\)</p> <p>For the pendulum: \(\omega_{n+1/2} = \omega_n + \frac{h}{2} \left(-\frac{g}{L}\sin(\theta_n)\right)\) \(\theta_{n+1} = \theta_n + h \cdot \omega_{n+1/2}\) \(\omega_{n+1} = \omega_{n+1/2} + \frac{h}{2} \left(-\frac{g}{L}\sin(\theta_{n+1})\right)\)</p> <p><strong>Superior Properties:</strong></p> <ul> <li> <strong>Order of accuracy</strong>: \(O(h^2)\) - second-order accurate</li> <li> <strong>Symplectic</strong>: Preserves phase space structure exactly</li> <li> <strong>Time-reversible</strong>: \(\mathbf{M}^{-1} = \mathbf{M}^T\)</li> <li> <strong>Stability</strong>: Excellent long-term energy conservation</li> </ul> <p><strong>Computational Cost Analysis:</strong></p> <ul> <li> <strong>Function evaluations</strong>: 2 per timestep (vs. 1 for Euler methods)</li> <li> <strong>Memory overhead</strong>: Minimal (stores half-step velocity)</li> <li> <strong>Efficiency</strong>: Optimal balance of accuracy and computational cost</li> </ul> <p><strong>Why Verlet Dominates Molecular Dynamics:</strong> The method‚Äôs symplectic nature combined with second-order accuracy makes it the gold standard for molecular dynamics simulations, where energy conservation over millions of timesteps is crucial.</p> <div id="verlet-demo" style="max-width: 100%; margin: 30px 0; box-shadow: var(--global-box-shadow-lg);"> <div style="background-color: var(--global-card-bg-color); border-radius: 12px; padding: 30px; color: var(--global-text-color); border: 1px solid var(--global-border-color);"> <div style="display: flex; align-items: center; margin-bottom: 25px;"> <div style="width: 4px; height: 30px; background: linear-gradient(to bottom, #3b82f6, #2563eb); border-radius: 2px; margin-right: 15px;"></div> <h4 style="margin: 0; color: #3b82f6; font-size: 1.4em; font-weight: 600;">Velocity Verlet Method</h4> <span style="margin-left: auto; background: rgba(59, 130, 246, 0.15); color: #3b82f6; padding: 4px 12px; border-radius: 20px; font-size: 0.8em; font-weight: 500;">Superior Accuracy</span> </div> <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;"> <div style="background-color: var(--global-bg-color-secondary); border-radius: 12px; padding: 20px; border: 1px solid var(--global-border-color);"> <h5 style="margin: 0 0 15px 0; color: var(--global-heading-color); font-size: 1.1em;">Pendulum Animation</h5> <div style="position: relative; border-radius: 10px; overflow: hidden; box-shadow: var(--global-box-shadow-sm);"> <canvas id="verlet-canvas" width="280" height="280" style="background-color: var(--global-bg-color-secondary); width: 100%; display: block;"></canvas> </div> </div> <div style="background-color: var(--global-bg-color-secondary); border-radius: 12px; padding: 20px; border: 1px solid var(--global-border-color);"> <h5 style="margin: 0 0 15px 0; color: var(--global-heading-color); font-size: 1.1em;">Energy Over Time</h5> <div style="position: relative; border-radius: 10px; overflow: hidden; box-shadow: var(--global-box-shadow-sm);"> <canvas id="verlet-energy" width="280" height="280" style="background-color: var(--global-bg-color-secondary); width: 100%; display: block;"></canvas> </div> </div> </div> <div style="display: flex; align-items: center; justify-content: space-between; background-color: var(--global-bg-color-secondary); border-radius: 10px; padding: 15px; border: 1px solid var(--global-border-color);"> <div style="display: flex; align-items: center; gap: 15px;"> <label style="color: var(--global-text-color); font-weight: 500;">Time Step: <span id="verlet-timestep" style="color: #3b82f6; font-weight: 600;">10</span> ms</label> <input type="range" id="verlet-slider" min="1" max="50" value="10" style="width: 200px; accent-color: #3b82f6;"> </div> <div style="display: flex; gap: 10px;"> <button id="verlet-play-pause" style="background: linear-gradient(135deg, #10b981, #059669); border: none; color: white; padding: 8px 16px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: var(--global-box-shadow-md);">Pause</button> <button id="verlet-reset" style="background: linear-gradient(135deg, #3b82f6, #2563eb); border: none; color: white; padding: 8px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: var(--global-box-shadow-md);">Reset</button> </div> </div> <div style="margin-top: 15px; text-align: center; font-size: 14px;"> Energy Error: <span id="verlet-error" style="background: rgba(59, 130, 246, 0.2); color: #3b82f6; padding: 4px 12px; border-radius: 20px; font-weight: 600;">0.00%</span> </div> </div> </div> <h3 id="method-4-runge-kutta-4th-order---the-accuracy-champion">Method 4: Runge-Kutta 4th Order - The Accuracy Champion</h3> <p><strong>RK4</strong> achieves exceptional local accuracy through four intermediate evaluations per timestep:</p> <p><strong>Algorithm:</strong> \(k_1 = f(t_n, y_n)\) \(k_2 = f(t_n + h/2, y_n + hk_1/2)\) \(k_3 = f(t_n + h/2, y_n + hk_2/2)\) \(k_4 = f(t_n + h, y_n + hk_3)\) \(y_{n+1} = y_n + \frac{h}{6}(k_1 + 2k_2 + 2k_3 + k_4)\)</p> <p><strong>Theoretical Foundation:</strong> RK4 achieves fourth-order accuracy by matching the first four terms of the Taylor series expansion. The method can be derived through the theory of trees (Butcher trees) which provide a systematic approach to constructing high-order Runge-Kutta methods.</p> <p><strong>The Symplectic Trade-off:</strong> While RK4 excels in local accuracy, it is <strong>not symplectic</strong>. For dissipative systems (with damping), this is often acceptable or even desirable. For conservative systems, the lack of geometric structure preservation can lead to subtle but systematic energy drift over long time scales.</p> <p><strong>Performance Characteristics:</strong></p> <ul> <li> <strong>Order of accuracy</strong>: \(O(h^4)\) - fourth-order accurate</li> <li> <strong>Function evaluations</strong>: 4 per timestep</li> <li> <strong>Memory overhead</strong>: Minimal temporary storage</li> <li> <strong>Computational cost</strong>: 4√ó that of simple methods per timestep</li> </ul> <div id="rk4-demo" style="max-width: 100%; margin: 30px 0; box-shadow: var(--global-box-shadow-lg);"> <div style="background-color: var(--global-card-bg-color); border-radius: 12px; padding: 30px; color: var(--global-text-color); border: 1px solid var(--global-border-color);"> <div style="display: flex; align-items: center; margin-bottom: 25px;"> <div style="width: 4px; height: 30px; background: linear-gradient(to bottom, #a855f7, #9333ea); border-radius: 2px; margin-right: 15px;"></div> <h4 style="margin: 0; color: #a855f7; font-size: 1.4em; font-weight: 600;">Runge-Kutta 4th Order</h4> <span style="margin-left: auto; background: rgba(168, 85, 247, 0.15); color: #a855f7; padding: 4px 12px; border-radius: 20px; font-size: 0.8em; font-weight: 500;">High Accuracy</span> </div> <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;"> <div style="background-color: var(--global-bg-color-secondary); border-radius: 12px; padding: 20px; border: 1px solid var(--global-border-color);"> <h5 style="margin: 0 0 15px 0; color: var(--global-heading-color); font-size: 1.1em;">Pendulum Animation</h5> <div style="position: relative; border-radius: 10px; overflow: hidden; box-shadow: var(--global-box-shadow-sm);"> <canvas id="rk4-canvas" width="280" height="280" style="background-color: var(--global-bg-color-secondary); width: 100%; display: block;"></canvas> </div> </div> <div style="background-color: var(--global-bg-color-secondary); border-radius: 12px; padding: 20px; border: 1px solid var(--global-border-color);"> <h5 style="margin: 0 0 15px 0; color: var(--global-heading-color); font-size: 1.1em;">Energy Over Time</h5> <div style="position: relative; border-radius: 10px; overflow: hidden; box-shadow: var(--global-box-shadow-sm);"> <canvas id="rk4-energy" width="280" height="280" style="background-color: var(--global-bg-color-secondary); width: 100%; display: block;"></canvas> </div> </div> </div> <div style="display: flex; align-items: center; justify-content: space-between; background-color: var(--global-bg-color-secondary); border-radius: 10px; padding: 15px; border: 1px solid var(--global-border-color);"> <div style="display: flex; align-items: center; gap: 15px;"> <label style="color: var(--global-text-color); font-weight: 500;">Time Step: <span id="rk4-timestep" style="color: #a855f7; font-weight: 600;">10</span> ms</label> <input type="range" id="rk4-slider" min="1" max="50" value="10" style="width: 200px; accent-color: #a855f7;"> </div> <div style="display: flex; gap: 10px;"> <button id="rk4-play-pause" style="background: linear-gradient(135deg, #10b981, #059669); border: none; color: white; padding: 8px 16px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: var(--global-box-shadow-md);">Pause</button> <button id="rk4-reset" style="background: linear-gradient(135deg, #a855f7, #9333ea); border: none; color: white; padding: 8px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: var(--global-box-shadow-md);">Reset</button> </div> </div> <div style="margin-top: 15px; text-align: center; font-size: 14px;"> Energy Error: <span id="rk4-error" style="background: rgba(168, 85, 247, 0.2); color: #a855f7; padding: 4px 12px; border-radius: 20px; font-weight: 600;">0.00%</span> </div> </div> </div> <h2 id="real-time-method-comparison-side-by-side-analysis">Real-Time Method Comparison: Side-by-Side Analysis</h2> <p>Experience all four integration methods simultaneously to see their fundamental differences in action.</p> <div id="realtime-comparison" style="max-width: 100%; margin: 30px 0;"> <div style="background-color: var(--global-card-bg-color); border-radius: 12px; padding: 25px; color: var(--global-text-color); border: 1px solid var(--global-border-color); box-shadow: var(--global-box-shadow-lg);"> <div style="display: flex; align-items: center; margin-bottom: 25px;"> <div style="width: 4px; height: 30px; background: linear-gradient(to bottom, var(--global-theme-color), var(--global-theme-color-dark)); border-radius: 2px; margin-right: 15px;"></div> <h4 style="margin: 0; color: var(--global-theme-color); font-size: 1.4em; font-weight: 600;">Real-Time Method Comparison</h4> <span style="margin-left: auto; background: rgba(59, 130, 246, 0.15); color: var(--global-theme-color); padding: 4px 12px; border-radius: 20px; font-size: 0.8em; font-weight: 500;">All Methods</span> </div> <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;"> <div style="background-color: var(--global-bg-color-secondary); border-radius: 12px; padding: 15px; border: 1px solid var(--global-border-color);"> <h5 style="margin: 0 0 10px 0; color: #ef4444; font-size: 0.9em; text-align: center;">Explicit Euler</h5> <canvas id="realtime-euler-canvas" width="200" height="200" style="background-color: var(--global-bg-color-secondary); width: 100%; display: block; border-radius: 8px;"></canvas> </div> <div style="background-color: var(--global-bg-color-secondary); border-radius: 12px; padding: 15px; border: 1px solid var(--global-border-color);"> <h5 style="margin: 0 0 10px 0; color: #22c55e; font-size: 0.9em; text-align: center;">Symplectic Euler</h5> <canvas id="realtime-symplectic-canvas" width="200" height="200" style="background-color: var(--global-bg-color-secondary); width: 100%; display: block; border-radius: 8px;"></canvas> </div> <div style="background-color: var(--global-bg-color-secondary); border-radius: 12px; padding: 15px; border: 1px solid var(--global-border-color);"> <h5 style="margin: 0 0 10px 0; color: #3b82f6; font-size: 0.9em; text-align: center;">Velocity Verlet</h5> <canvas id="realtime-verlet-canvas" width="200" height="200" style="background-color: var(--global-bg-color-secondary); width: 100%; display: block; border-radius: 8px;"></canvas> </div> <div style="background-color: var(--global-bg-color-secondary); border-radius: 12px; padding: 15px; border: 1px solid var(--global-border-color);"> <h5 style="margin: 0 0 10px 0; color: #a855f7; font-size: 0.9em; text-align: center;">RK4</h5> <canvas id="realtime-rk4-canvas" width="200" height="200" style="background-color: var(--global-bg-color-secondary); width: 100%; display: block; border-radius: 8px;"></canvas> </div> </div> <div style="background-color: var(--global-bg-color-secondary); border-radius: 12px; padding: 20px; border: 1px solid var(--global-border-color); margin-bottom: 20px;"> <h5 style="margin: 0 0 15px 0; color: var(--global-heading-color); font-size: 1.1em;">Energy Evolution Comparison</h5> <canvas id="realtime-energy-chart" width="600" height="300" style="background-color: var(--global-bg-color-secondary); width: 100%; display: block; border-radius: 8px;"></canvas> </div> <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;"> <div> <h5 style="color: var(--global-heading-color); margin-bottom: 10px;">Simulation Parameters</h5> <div style="margin-bottom: 10px;"> <label style="color: var(--global-text-color);">Initial Angle: <span id="realtime-angle">45</span>¬∞</label> <input type="range" id="realtime-angle-slider" min="10" max="170" value="45" style="width: 100%; accent-color: var(--global-theme-color);"> </div> <div style="margin-bottom: 10px;"> <label style="color: var(--global-text-color);">Time Step: <span id="realtime-timestep">10</span> ms</label> <input type="range" id="realtime-timestep-slider" min="1" max="50" value="10" style="width: 100%; accent-color: var(--global-theme-color);"> </div> </div> <div> <h5 style="color: var(--global-heading-color); margin-bottom: 10px;">Current Energy Errors</h5> <div style="font-size: 12px; line-height: 1.4;"> <div style="color: var(--global-text-color);">Time: <span id="realtime-time">0.00</span>s</div> <div style="color: #ef4444;">Explicit Euler: <span id="realtime-euler-error">0.00</span>%</div> <div style="color: #22c55e;">Symplectic Euler: <span id="realtime-symplectic-error">0.00</span>%</div> <div style="color: #3b82f6;">Velocity Verlet: <span id="realtime-verlet-error">0.00</span>%</div> <div style="color: #a855f7;">RK4: <span id="realtime-rk4-error">0.00</span>%</div> </div> </div> </div> <div style="text-align: center;"> <button id="realtime-play-pause" style="background: var(--global-gradient-primary); border: none; color: white; padding: 10px 20px; border-radius: 8px; margin-right: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);">Pause</button> <button id="realtime-reset" style="background: #FF6B6B; border: none; color: white; padding: 10px 20px; border-radius: 8px; margin-right: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);">Reset All</button> <button id="realtime-sync" style="background: #10B981; border: none; color: white; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);">Sync Methods</button> </div> <div style="margin-top: 15px; padding: 15px; background-color: rgba(59, 130, 246, 0.1); border-radius: 8px; font-size: 13px; color: var(--global-text-color);"> <strong>üí° Watch carefully:</strong> Notice how Explicit Euler (red) spirals outward while Symplectic methods (green/blue) maintain bounded motion. RK4 (purple) shows subtle drift over longer periods. </div> </div> </div> <h2 id="comparative-analysis-and-stability-theory">Comparative Analysis and Stability Theory</h2> <h3 id="computational-complexity-analysis">Computational Complexity Analysis</h3> <table> <thead> <tr> <th>Method</th> <th>Order</th> <th>Function Evaluations</th> <th>Memory</th> <th>Symplectic</th> <th>Energy Behavior</th> </tr> </thead> <tbody> <tr> <td>Explicit Euler</td> <td>\(O(h)\)</td> <td>1</td> <td>Minimal</td> <td>‚ùå</td> <td>Exponential growth</td> </tr> <tr> <td>Symplectic Euler</td> <td>\(O(h)\)</td> <td>1</td> <td>Minimal</td> <td>‚úÖ</td> <td>Bounded oscillations</td> </tr> <tr> <td>Velocity Verlet</td> <td>\(O(h^2)\)</td> <td>2</td> <td>Low</td> <td>‚úÖ</td> <td>Excellent conservation</td> </tr> <tr> <td>RK4</td> <td>\(O(h^4)\)</td> <td>4</td> <td>Low</td> <td>‚ùå</td> <td>Subtle long-term drift</td> </tr> </tbody> </table> <h3 id="the-fundamental-trade-off-accuracy-vs-structure">The Fundamental Trade-off: Accuracy vs. Structure</h3> <p>For conservative Hamiltonian systems, we face a fundamental choice:</p> <p><strong>Local Accuracy Priority</strong> (RK4, higher-order methods):</p> <ul> <li>Superior accuracy for individual timesteps</li> <li>Excellent for short-term, high-precision calculations</li> <li>May exhibit energy drift over extended simulations</li> <li>Ideal for dissipative systems where energy conservation is not required</li> </ul> <p><strong>Geometric Structure Priority</strong> (Symplectic methods):</p> <ul> <li>Preserve essential physical invariants</li> <li>Maintain bounded energy errors indefinitely</li> <li>Provide qualitatively correct long-term behavior</li> <li>Essential for conservative system simulation</li> </ul> <h3 id="stability-analysis-through-linear-theory">Stability Analysis Through Linear Theory</h3> <p>For the linearized pendulum (\(\sin\theta \approx \theta\)), the equation becomes:</p> \[\frac{d^2\theta}{dt^2} + \omega_0^2\theta = 0\] <p>where \(\omega_0 = \sqrt{g/L}\) is the natural frequency.</p> <p><strong>Explicit Euler Stability:</strong> The amplification matrix eigenvalues are: \(\lambda_{\pm} = 1 \pm i h \omega_0\)</p> <p>Their magnitudes are: \(|\lambda_{\pm}| = \sqrt{1 + (h\omega_0)^2} &gt; 1 \quad \text{for any } h&gt;0\)</p> <table> <tbody> <tr> <td>This explains the exponential energy growth. For $$</td> <td>\lambda</td> <td>&gt; 1$$, the solution grows exponentially.</td> </tr> </tbody> </table> <p><strong>Symplectic Euler Stability:</strong> The eigenvalues lie exactly on the unit circle: \(|\lambda| = 1\) for all \(h\). This guarantees bounded solutions for arbitrary timestep sizes.</p> <h2 id="interactive-comparison-complete-behavioral-analysis">Interactive Comparison: Complete Behavioral Analysis</h2> <div id="comparison-demo" style="max-width: 100%; margin: 20px 0;"> <div style="background-color: var(--global-card-bg-color); border-radius: 12px; padding: 20px; color: var(--global-text-color); border: 1px solid var(--global-border-color); box-shadow: var(--global-box-shadow-lg);"> <h4 style="margin: 0 0 20px 0; color: var(--global-theme-color);">Complete Comparison - All Integration Methods</h4> <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;"> <div> <h5 style="color: var(--global-heading-color);">Selected Pendulum Animation</h5> <canvas id="comparison-canvas" width="300" height="300" style="background-color: var(--global-bg-color-secondary); border-radius: 8px; width: 100%; border: 1px solid var(--global-border-color);"></canvas> <div style="margin-top: 10px;"> <label style="color: var(--global-text-color);">Display Method: </label> <select id="comparison-select" style="background-color: var(--global-card-bg-color); color: var(--global-text-color); border: 1px solid var(--global-border-color); padding: 5px; border-radius: 4px;"> <option value="symplectic">Symplectic Euler</option> <option value="euler">Explicit Euler</option> <option value="verlet">Velocity Verlet</option> <option value="rk4">RK4</option> </select> </div> </div> <div> <h5 style="color: var(--global-heading-color);">Energy Drift Comparison</h5> <canvas id="comparison-energy" width="300" height="300" style="background-color: var(--global-bg-color-secondary); border-radius: 8px; width: 100%; border: 1px solid var(--global-border-color);"></canvas> <div style="margin-top: 10px; display: flex; flex-wrap: wrap; gap: 10px; font-size: 11px;"> <div style="display: flex; align-items: center; gap: 4px;"> <div style="width: 12px; height: 12px; background: #ef4444; border-radius: 50%;"></div> <span style="color: var(--global-text-color);">Explicit Euler</span> </div> <div style="display: flex; align-items: center; gap: 4px;"> <div style="width: 12px; height: 12px; background: #22c55e; border-radius: 50%;"></div> <span style="color: var(--global-text-color);">Symplectic Euler</span> </div> <div style="display: flex; align-items: center; gap: 4px;"> <div style="width: 12px; height: 12px; background: #3b82f6; border-radius: 50%;"></div> <span style="color: var(--global-text-color);">Velocity Verlet</span> </div> <div style="display: flex; align-items: center; gap: 4px;"> <div style="width: 12px; height: 12px; background: #a855f7; border-radius: 50%;"></div> <span style="color: var(--global-text-color);">RK4</span> </div> </div> </div> </div> <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;"> <div> <h5 style="color: var(--global-heading-color);">Initial Conditions</h5> <div style="margin-bottom: 10px;"> <label style="color: var(--global-text-color);">Initial Angle: <span id="comparison-angle">45</span>¬∞</label> <input type="range" id="comparison-angle-slider" min="10" max="170" value="45" style="width: 100%; accent-color: var(--global-theme-color);"> </div> <div> <label style="color: var(--global-text-color);">Time Step: <span id="comparison-timestep">10</span> ms</label> <input type="range" id="comparison-timestep-slider" min="1" max="50" value="10" style="width: 100%; accent-color: var(--global-theme-color);"> </div> </div> <div> <h5 style="color: var(--global-heading-color);">Current Energy Errors</h5> <div style="font-size: 12px;"> <div style="color: var(--global-text-color);">Time: <span id="comparison-time">0.00</span>s</div> <div style="color: #ef4444;">Explicit Euler: <span id="comparison-euler-error">0.00</span>%</div> <div style="color: #22c55e;">Symplectic Euler: <span id="comparison-symplectic-error">0.00</span>%</div> <div style="color: #3b82f6;">Velocity Verlet: <span id="comparison-verlet-error">0.00</span>%</div> <div style="color: #a855f7;">RK4: <span id="comparison-rk4-error">0.00</span>%</div> </div> </div> </div> <div style="text-align: center;"> <button id="comparison-play-pause" style="background: var(--global-gradient-primary); border: none; color: white; padding: 10px 20px; border-radius: 6px; margin-right: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);">Pause</button> <button id="comparison-reset" style="background: #FF6B6B; border: none; color: white; padding: 10px 20px; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);">Reset All</button> </div> </div> </div> <h2 id="real-world-applications-and-case-studies">Real-World Applications and Case Studies</h2> <h3 id="case-study-1-climate-modeling---the-ecmwf-experience">Case Study 1: Climate Modeling - The ECMWF Experience</h3> <p>The European Centre for Medium-Range Weather Forecasts (ECMWF) faced a critical challenge: their atmospheric models were exhibiting systematic energy drift over long-term climate runs.</p> <p><strong>The Problem:</strong></p> <ul> <li> <strong>Simulation duration</strong>: 100+ year climate projections</li> <li> <strong>Energy drift</strong>: 0.1% per decade using standard methods</li> <li> <strong>Consequence</strong>: Artificial warming trends corrupting climate predictions</li> </ul> <p><strong>The Solution:</strong> Implementation of energy-conserving finite difference schemes based on symplectic principles:</p> <div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">! Symplectic time stepping for atmospheric dynamics</span><span class="w">
</span><span class="k">do</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nlevels</span><span class="w">
    </span><span class="c1">! Update momentum first (symplectic)</span><span class="w">
    </span><span class="n">u_new</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_old</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">forcing_u</span><span class="p">(</span><span class="n">u_old</span><span class="p">,</span><span class="w"> </span><span class="n">v_old</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w">
    </span><span class="n">v_new</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v_old</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">forcing_v</span><span class="p">(</span><span class="n">u_old</span><span class="p">,</span><span class="w"> </span><span class="n">v_old</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w">
    
    </span><span class="c1">! Update positions using new momentum</span><span class="w">
    </span><span class="n">x</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_new</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w">
    </span><span class="n">y</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_new</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="k">do</span><span class="w">
</span></code></pre></div></div> <p><strong>Results:</strong></p> <ul> <li>Energy drift reduced to &lt; 0.01% per century</li> <li>Improved long-term climate stability</li> <li>More reliable temperature trend predictions</li> </ul> <h3 id="case-study-2-molecular-dynamics---the-gromacs-success-story">Case Study 2: Molecular Dynamics - The GROMACS Success Story</h3> <p>GROMACS, one of the most widely used molecular dynamics packages, owes its success largely to the adoption of Velocity Verlet integration.</p> <p><strong>System Characteristics:</strong></p> <ul> <li> <strong>Particle count</strong>: 10‚Å∂ - 10‚Åπ atoms</li> <li> <strong>Simulation time</strong>: nanoseconds to microseconds</li> <li> <strong>Timestep</strong>: 1-2 femtoseconds</li> <li> <strong>Total steps</strong>: 10‚Åπ - 10¬π¬≤ integration steps</li> </ul> <p><strong>Why Symplectic Methods Are Essential:</strong></p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Velocity Verlet implementation in GROMACS</span>
<span class="kt">void</span> <span class="nf">update_positions_and_velocities</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">real</span> <span class="n">dt</span><span class="p">,</span>
                                   <span class="n">rvec</span> <span class="n">x</span><span class="p">[],</span> <span class="n">rvec</span> <span class="n">v</span><span class="p">[],</span> <span class="n">rvec</span> <span class="n">f</span><span class="p">[],</span> <span class="n">real</span> <span class="n">mass</span><span class="p">[])</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Half-step velocity update</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">DIM</span><span class="p">;</span> <span class="n">d</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">dt</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">/</span> <span class="n">mass</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
        
        <span class="c1">// Full-step position update</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">DIM</span><span class="p">;</span> <span class="n">d</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1">// Compute new forces at updated positions</span>
    <span class="n">compute_forces</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
    
    <span class="c1">// Complete velocity update</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">DIM</span><span class="p">;</span> <span class="n">d</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">dt</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> <span class="o">/</span> <span class="n">mass</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><strong>Critical Performance Metrics:</strong></p> <ul> <li> <strong>Energy conservation</strong>: &lt; 0.01% drift over microsecond simulations</li> <li> <strong>Temperature stability</strong>: Canonical ensemble maintained without thermostats</li> <li> <strong>Computational efficiency</strong>: Optimal balance of accuracy and speed</li> </ul> <h3 id="case-study-3-spacecraft-navigation---the-new-horizons-mission">Case Study 3: Spacecraft Navigation - The New Horizons Mission</h3> <p>NASA‚Äôs New Horizons mission to Pluto required extraordinary precision in trajectory calculation over a 9-year journey.</p> <p><strong>Navigation Challenges:</strong></p> <ul> <li> <strong>Journey duration</strong>: 9 years (2.8 √ó 10‚Å∏ seconds)</li> <li> <strong>Precision requirement</strong>: &lt; 3000 km accuracy at Pluto encounter</li> <li> <strong>Perturbations</strong>: Gravitational effects from multiple bodies, solar radiation pressure</li> </ul> <p><strong>Integration Strategy:</strong> NASA used a combination of symplectic methods for long-term stability with adaptive high-order methods for critical maneuvers:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">spacecraft_propagator</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">adaptive</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">adaptive</span> <span class="ow">or</span> <span class="n">critical_maneuver</span><span class="p">:</span>
        <span class="c1"># High-precision RK4 with adaptive timestep
</span>        <span class="k">return</span> <span class="nf">rk4_adaptive</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Symplectic integration for cruise phase
</span>        <span class="k">return</span> <span class="nf">symplectic_euler</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</code></pre></div></div> <p><strong>Results:</strong></p> <ul> <li>Pluto encounter within 3000 km of predicted position</li> <li>Total trajectory error &lt; 0.01% after 9-year journey</li> <li>Successful flyby of Arrokoth (2014 MU69) in 2019</li> </ul> <h2 id="advanced-topics-in-numerical-integration">Advanced Topics in Numerical Integration</h2> <h3 id="higher-order-symplectic-methods">Higher-Order Symplectic Methods</h3> <p>While Symplectic Euler and Velocity Verlet are first and second-order accurate respectively, higher-order symplectic methods can be constructed using <strong>composition methods</strong>.</p> <p><strong>Forest-Ruth Algorithm (4th Order Symplectic):</strong> \(\mathbf{S}_4 = \mathbf{S}_h^{\theta_1} \circ \mathbf{S}_h^{\theta_2} \circ \mathbf{S}_h^{\theta_3} \circ \mathbf{S}_h^{\theta_2} \circ \mathbf{S}_h^{\theta_1}\)</p> <p>where \(\mathbf{S}_h\) is the basic symplectic map and:</p> <ul> <li> \[\theta_1 = \theta_3 = \frac{1}{2 - 2^{1/3}}\] </li> <li> \[\theta_2 = -\frac{2^{1/3}}{2 - 2^{1/3}}\] </li> </ul> <p><strong>Trade-offs:</strong></p> <ul> <li> <strong>Pros</strong>: Fourth-order accuracy with exact energy conservation</li> <li> <strong>Cons</strong>: 5√ó computational cost per timestep vs. Velocity Verlet</li> </ul> <h3 id="adaptive-time-stepping-strategies">Adaptive Time Stepping Strategies</h3> <p>For systems with multiple timescales, adaptive time stepping can dramatically improve efficiency:</p> <p><strong>Richardson Extrapolation:</strong></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">adaptive_symplectic_step</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">h_initial</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">):</span>
    <span class="c1"># Take one step of size h
</span>    <span class="n">state_h</span> <span class="o">=</span> <span class="nf">symplectic_step</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">h_initial</span><span class="p">)</span>
    
    <span class="c1"># Take two steps of size h/2
</span>    <span class="n">state_temp</span> <span class="o">=</span> <span class="nf">symplectic_step</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">h_initial</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">state_h2</span> <span class="o">=</span> <span class="nf">symplectic_step</span><span class="p">(</span><span class="n">state_temp</span><span class="p">,</span> <span class="n">h_initial</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># Estimate error
</span>    <span class="n">error</span> <span class="o">=</span> <span class="nf">norm</span><span class="p">(</span><span class="n">state_h</span> <span class="o">-</span> <span class="n">state_h2</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">error</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">:</span>
        <span class="c1"># Accept step with Richardson extrapolation
</span>        <span class="nf">return </span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">state_h2</span> <span class="o">-</span> <span class="n">state_h</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">h_initial</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Reduce timestep and retry
</span>        <span class="k">return</span> <span class="nf">adaptive_symplectic_step</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">h_initial</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span>
</code></pre></div></div> <h3 id="multiple-time-scale-methods">Multiple Time Scale Methods</h3> <p>Systems like planetary motion (fast orbital motion + slow precession) benefit from multiple timestep methods:</p> <p><strong>Impulse-Velocity-Impulse (IVI) Decomposition:</strong></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">multiple_timestep_integrator</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">dt_fast</span><span class="p">,</span> <span class="n">dt_slow</span><span class="p">,</span> <span class="n">n_substeps</span><span class="p">):</span>
    <span class="c1"># Slow force impulse (half step)
</span>    <span class="n">state</span> <span class="o">=</span> <span class="nf">apply_slow_forces</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">dt_slow</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># Fast evolution with multiple substeps
</span>    <span class="n">dt_sub</span> <span class="o">=</span> <span class="n">dt_slow</span> <span class="o">/</span> <span class="n">n_substeps</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_substeps</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="nf">symplectic_step_fast_forces</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">dt_sub</span><span class="p">)</span>
    
    <span class="c1"># Slow force impulse (half step)
</span>    <span class="n">state</span> <span class="o">=</span> <span class="nf">apply_slow_forces</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">dt_slow</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></div> <h2 id="implementation-best-practices">Implementation Best Practices</h2> <h3 id="1-timestep-selection-guidelines">1. Timestep Selection Guidelines</h3> <p><strong>Conservative Systems (Hamiltonian):</strong></p> <ul> <li> <strong>Symplectic methods</strong>: \(h \leq \frac{T}{20}\) where \(T\) is the shortest characteristic period</li> <li> <strong>RK4</strong>: \(h \leq \frac{T}{100}\) for comparable accuracy to symplectic methods</li> </ul> <p><strong>Dissipative Systems:</strong></p> <ul> <li> <strong>RK4 preferred</strong>: Higher local accuracy compensates for energy dissipation</li> <li> <strong>Adaptive methods</strong>: Essential for stiff systems with multiple timescales</li> </ul> <h3 id="2-energy-conservation-monitoring">2. Energy Conservation Monitoring</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">EnergyMonitor</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">initial_energy</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">E0</span> <span class="o">=</span> <span class="n">initial_energy</span>
        <span class="n">self</span><span class="p">.</span><span class="n">tolerance</span> <span class="o">=</span> <span class="n">tolerance</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_error</span> <span class="o">=</span> <span class="mi">0</span>
        
    <span class="k">def</span> <span class="nf">check_energy</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">current_energy</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="n">relative_error</span> <span class="o">=</span> <span class="nf">abs</span><span class="p">(</span><span class="n">current_energy</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">E0</span><span class="p">)</span> <span class="o">/</span> <span class="nf">abs</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">E0</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_error</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">max_error</span><span class="p">,</span> <span class="n">relative_error</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">relative_error</span> <span class="o">&gt;</span> <span class="n">self</span><span class="p">.</span><span class="n">tolerance</span><span class="p">:</span>
            <span class="n">warnings</span><span class="p">.</span><span class="nf">warn</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Energy error </span><span class="si">{</span><span class="n">relative_error</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">e</span><span class="si">}</span><span class="s"> exceeds tolerance at t=</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">relative_error</span>
</code></pre></div></div> <h3 id="3-numerical-precision-considerations">3. Numerical Precision Considerations</h3> <p><strong>Double vs. Extended Precision:</strong></p> <ul> <li>Standard double precision (64-bit): ~15 decimal digits</li> <li>For long-term simulations: Consider extended precision (80-bit) or arbitrary precision arithmetic</li> <li>GPU implementations: Be aware of reduced precision in single-precision calculations</li> </ul> <h3 id="4-symplectic-integrator-verification">4. Symplectic Integrator Verification</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">verify_symplectic_property</span><span class="p">(</span><span class="n">integrator</span><span class="p">,</span> <span class="n">state0</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Verify that phase space volume is conserved</span><span class="sh">"""</span>
    <span class="c1"># Create small perturbation in phase space
</span>    <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-8</span>
    <span class="n">states</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">state0</span><span class="p">,</span>
        <span class="n">state0</span> <span class="o">+</span> <span class="p">[</span><span class="n">epsilon</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">state0</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">],</span>
        <span class="n">state0</span> <span class="o">+</span> <span class="p">[</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">]</span>
    <span class="p">]</span>
    
    <span class="c1"># Evolve all perturbed states
</span>    <span class="n">final_states</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
            <span class="n">current</span> <span class="o">=</span> <span class="nf">integrator</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
        <span class="n">final_states</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
    
    <span class="c1"># Compute initial and final phase space volumes
</span>    <span class="n">initial_volume</span> <span class="o">=</span> <span class="nf">compute_phase_space_volume</span><span class="p">(</span><span class="n">states</span><span class="p">)</span>
    <span class="n">final_volume</span> <span class="o">=</span> <span class="nf">compute_phase_space_volume</span><span class="p">(</span><span class="n">final_states</span><span class="p">)</span>
    
    <span class="n">volume_change</span> <span class="o">=</span> <span class="nf">abs</span><span class="p">(</span><span class="n">final_volume</span> <span class="o">-</span> <span class="n">initial_volume</span><span class="p">)</span> <span class="o">/</span> <span class="n">initial_volume</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Phase space volume change: </span><span class="si">{</span><span class="n">volume_change</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">volume_change</span> <span class="o">&lt;</span> <span class="mf">1e-10</span>  <span class="c1"># Should be essentially zero for symplectic methods
</span></code></pre></div></div> <h2 id="troubleshooting-common-issues">Troubleshooting Common Issues</h2> <h3 id="problem-energy-growth-in-symplectic-methods">Problem: Energy Growth in Symplectic Methods</h3> <p><strong>Symptoms:</strong> Energy increases systematically despite using symplectic integrator</p> <p><strong>Potential Causes:</strong></p> <ol> <li> <strong>Implementation error</strong>: Check that momentum is updated before position</li> <li> <strong>Floating-point precision</strong>: Accumulation of round-off errors over millions of steps</li> <li> <strong>Timestep too large</strong>: Linear stability analysis assumes small timesteps</li> </ol> <p><strong>Solutions:</strong></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Correct symplectic Euler implementation
</span><span class="k">def</span> <span class="nf">symplectic_euler_correct</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
    <span class="c1"># CORRECT: Update omega first
</span>    <span class="n">omega_new</span> <span class="o">=</span> <span class="n">omega</span> <span class="o">-</span> <span class="p">(</span><span class="n">dt</span> <span class="o">*</span> <span class="n">g</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span> <span class="o">*</span> <span class="nf">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">theta_new</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">omega_new</span>  <span class="c1"># Use NEW omega
</span>    <span class="k">return</span> <span class="n">theta_new</span><span class="p">,</span> <span class="n">omega_new</span>

<span class="c1"># INCORRECT implementation (produces energy growth)
</span><span class="k">def</span> <span class="nf">symplectic_euler_wrong</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
    <span class="c1"># WRONG: Updates done simultaneously
</span>    <span class="n">omega_new</span> <span class="o">=</span> <span class="n">omega</span> <span class="o">-</span> <span class="p">(</span><span class="n">dt</span> <span class="o">*</span> <span class="n">g</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span> <span class="o">*</span> <span class="nf">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">theta_new</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">omega</span>  <span class="c1"># Uses OLD omega
</span>    <span class="k">return</span> <span class="n">theta_new</span><span class="p">,</span> <span class="n">omega_new</span>
</code></pre></div></div> <h3 id="problem-stiff-system-instability">Problem: Stiff System Instability</h3> <p><strong>Symptoms:</strong> Simulation becomes unstable for small timesteps</p> <p><strong>Cause:</strong> Stiff differential equations require implicit methods</p> <p><strong>Solution:</strong> Use implicit-explicit (IMEX) methods:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">imex_euler</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">force_explicit</span><span class="p">,</span> <span class="n">force_implicit</span><span class="p">):</span>
    <span class="c1"># Explicit update for non-stiff terms
</span>    <span class="n">p_temp</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="nf">force_explicit</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    
    <span class="c1"># Implicit update for stiff terms (requires solver)
</span>    <span class="n">p_new</span> <span class="o">=</span> <span class="nf">solve_implicit</span><span class="p">(</span><span class="n">p_temp</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">force_implicit</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    <span class="n">q_new</span> <span class="o">=</span> <span class="n">q</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">p_new</span>
    
    <span class="k">return</span> <span class="n">q_new</span><span class="p">,</span> <span class="n">p_new</span>
</code></pre></div></div> <h3 id="problem-resonance-induced-instability">Problem: Resonance-Induced Instability</h3> <p><strong>Symptoms:</strong> Energy oscillates with growing amplitude over time</p> <p><strong>Cause:</strong> Timestep resonates with system‚Äôs natural frequency</p> <p><strong>Solution:</strong> Use irrational timestep ratios or variable timestep methods:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Golden ratio timestep to avoid resonances
</span><span class="n">dt_base</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">golden_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="nf">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">dt_adaptive</span> <span class="o">=</span> <span class="n">dt_base</span> <span class="o">/</span> <span class="n">golden_ratio</span>
</code></pre></div></div> <h2 id="future-directions-and-research-frontiers">Future Directions and Research Frontiers</h2> <h3 id="machine-learning-enhanced-integration">Machine Learning Enhanced Integration</h3> <p>Recent developments combine traditional numerical methods with machine learning:</p> <p><strong>Physics-Informed Neural Networks (PINNs):</strong></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">torch</span>
<span class="kn">import</span> <span class="n">torch.nn</span> <span class="k">as</span> <span class="n">nn</span>

<span class="k">class</span> <span class="nc">HamiltonianNet</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Tanh</span><span class="p">(),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Tanh</span><span class="p">(),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">net</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">cat</span><span class="p">([</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">symplectic_gradient</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">forward</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">dH_dq</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">autograd</span><span class="p">.</span><span class="nf">grad</span><span class="p">(</span><span class="n">H</span><span class="p">.</span><span class="nf">sum</span><span class="p">(),</span> <span class="n">q</span><span class="p">,</span> <span class="n">create_graph</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dH_dp</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">autograd</span><span class="p">.</span><span class="nf">grad</span><span class="p">(</span><span class="n">H</span><span class="p">.</span><span class="nf">sum</span><span class="p">(),</span> <span class="n">p</span><span class="p">,</span> <span class="n">create_graph</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">dH_dq</span><span class="p">,</span> <span class="n">dH_dp</span>  <span class="c1"># Hamilton's equations
</span></code></pre></div></div> <h3 id="quantum-classical-hybrid-systems">Quantum-Classical Hybrid Systems</h3> <p>Emerging applications require integration of quantum and classical dynamics:</p> <p><strong>Mean Field Theory Integration:</strong> For systems where quantum effects influence classical motion through expectation values.</p> <h3 id="geometric-deep-learning">Geometric Deep Learning</h3> <p>Using the geometric structure of phase space in neural network architectures:</p> <p><strong>Symplectic Neural Networks:</strong> Networks constrained to preserve symplectic structure exactly while learning complex dynamics.</p> <h2 id="conclusion-the-art-and-science-of-numerical-integration">Conclusion: The Art and Science of Numerical Integration</h2> <p>The exploration of energy drift in the simple pendulum reveals fundamental principles that extend far beyond this seemingly elementary system. We have witnessed how the choice of integration method can mean the difference between simulation success and catastrophic failure‚Äîbetween climate models that accurately predict future temperatures and those that exhibit spurious warming trends.</p> <h3 id="key-insights-from-our-journey">Key Insights from Our Journey</h3> <ol> <li> <p><strong>Geometric Structure Trumps Local Accuracy</strong>: Symplectic methods with first-order accuracy often outperform fourth-order methods that ignore geometric structure.</p> </li> <li> <p><strong>Conservation Laws Are Not Optional</strong>: For conservative systems, preserving invariants like energy, momentum, and phase space volume is essential for physical realism.</p> </li> <li> <p><strong>The Mathematics Has Real Consequences</strong>: The abstract concepts of symplectic geometry and Hamiltonian mechanics translate directly into practical simulation reliability.</p> </li> <li> <p><strong>Understanding Enables Optimization</strong>: Knowledge of stability theory, convergence analysis, and computational complexity allows informed selection of methods for specific applications.</p> </li> </ol> <h3 id="the-broader-impact">The Broader Impact</h3> <p>These principles extend throughout computational science:</p> <ul> <li> <strong>Climate Science</strong>: Energy-conserving atmospheric models</li> <li> <strong>Astronomy</strong>: Long-term planetary motion calculations</li> <li> <strong>Materials Science</strong>: Molecular dynamics simulations</li> <li> <strong>Engineering</strong>: Structural dynamics and vibration analysis</li> <li> <strong>Biology</strong>: Protein folding and cellular dynamics</li> <li> <strong>Finance</strong>: Long-term economic modeling</li> </ul> <h3 id="looking-forward">Looking Forward</h3> <p>As computational power continues to grow exponentially, the temptation exists to simply use smaller timesteps with traditional methods. However, this brute-force approach fails for systems requiring integration over geological timescales or astronomical distances. The future belongs to methods that respect the underlying mathematical structure of physical systems.</p> <p>The simple pendulum, in its elegant simplicity, embodies the rich mathematical structure that governs all of physics. By understanding how to preserve this structure numerically, we gain the power to simulate reality with unprecedented fidelity and extend our understanding of complex systems across all scales of nature.</p> <p><em>The mathematics of numerical integration isn‚Äôt merely computational technique‚Äîit‚Äôs the bridge between theoretical understanding and practical prediction, between the elegance of continuous mathematics and the reality of discrete computation.</em></p> <hr> <h2 id="further-reading-and-references">Further Reading and References</h2> <h3 id="essential-textbooks">Essential Textbooks</h3> <ul> <li> <strong>Hairer, E., Lubich, C., &amp; Wanner, G.</strong> (2006). <em>Geometric Numerical Integration: Structure-Preserving Algorithms for Ordinary Differential Equations</em>. Springer.</li> <li> <strong>Leimkuhler, B., &amp; Reich, S.</strong> (2004). <em>Simulating Hamiltonian Dynamics</em>. Cambridge University Press.</li> </ul> <h3 id="research-papers">Research Papers</h3> <ul> <li> <strong>Forest, E., &amp; Ruth, R. D.</strong> (1990). Fourth-order symplectic integration. <em>Physica D</em>, 43(1), 105-117.</li> <li> <strong>Yoshida, H.</strong> (1990). Construction of higher order symplectic integrators. <em>Physics Letters A</em>, 150(5), 262-268.</li> </ul> <h3 id="computational-tools">Computational Tools</h3> <ul> <li> <strong>GROMACS</strong>: <a href="http://www.gromacs.org" target="_blank" rel="noopener noreferrer">gromacs.org</a> - Molecular dynamics with Velocity Verlet</li> <li> <strong>NAMD</strong>: <a href="https://www.ks.uiuc.edu/Research/namd/" target="_blank" rel="noopener noreferrer">namd.org</a> - Large-scale parallel MD simulations</li> <li> <strong>yt-project</strong>: <a href="https://yt-project.org" target="_blank" rel="noopener noreferrer">yt-project.org</a> - Analysis tools for astrophysical simulations</li> </ul> <script>class SinglePendulumSim{constructor(t,e,s,i){this.canvas=document.getElementById(t),this.energyCanvas=document.getElementById(e),this.canvas&&this.energyCanvas?(this.ctx=this.canvas.getContext("2d"),this.energyCtx=this.energyCanvas.getContext("2d"),this.ctx&&this.energyCtx?(this.integrator=s,this.color=i,this.L=1,this.g=9.81,this.h=.01,this.theta=Math.PI/4,this.omega=0,this.time=0,this.running=!0,this.energyHistory=[],this.initialEnergy=this.energy(this.theta,this.omega),this.maxSamples=300,this.animate()):console.warn("Failed to get 2D context for canvases")):console.warn(`Canvas elements not found: ${t}, ${e}`)}togglePause(){return this.running=!this.running,this.running}acceleration(t){return-this.g/this.L*Math.sin(t)}energy(t,e){return this.g*this.L*(1-Math.cos(t))+this.L*this.L*.5*e*e}step(){if(this.running){switch(this.integrator){case"euler":const t=this.acceleration(this.theta);this.theta+=this.h*this.omega,this.omega+=this.h*t;break;case"symplectic":this.omega+=this.h*this.acceleration(this.theta),this.theta+=this.h*this.omega;break;case"verlet":const e=this.acceleration(this.theta),s=this.omega+.5*this.h*e;this.theta+=this.h*s;const i=this.acceleration(this.theta);this.omega=s+.5*this.h*i;break;case"rk4":const h=(t,e)=>[e,this.acceleration(t)],a=h(this.theta,this.omega),n=h(this.theta+.5*this.h*a[0],this.omega+.5*this.h*a[1]),r=h(this.theta+.5*this.h*n[0],this.omega+.5*this.h*n[1]),o=h(this.theta+this.h*r[0],this.omega+this.h*r[1]);this.theta+=this.h/6*(a[0]+2*n[0]+2*r[0]+o[0]),this.omega+=this.h/6*(a[1]+2*n[1]+2*r[1]+o[1])}if(this.time+=this.h,Math.floor(50*this.time)%2==0){const t=this.energy(this.theta,this.omega);this.energyHistory.push({t:this.time,E:t}),this.energyHistory.length>this.maxSamples&&this.energyHistory.shift()}}}draw(){const t=this.ctx,e=this.canvas,s=.35*Math.min(e.width,e.height),i=e.width/2,h=.2*e.height;t.clearRect(0,0,e.width,e.height);const a=i+s*Math.sin(this.theta),n=h+s*Math.cos(this.theta);t.strokeStyle=this.color,t.lineWidth=3,t.beginPath(),t.moveTo(i,h),t.lineTo(a,n),t.stroke(),t.fillStyle="#666",t.beginPath(),t.arc(i,h,5,0,2*Math.PI),t.fill(),t.fillStyle=this.color,t.beginPath(),t.arc(a,n,12,0,2*Math.PI),t.fill(),this.drawEnergyChart()}drawEnergyChart(){const t=this.energyCtx,e=this.energyCanvas;if(t.clearRect(0,0,e.width,e.height),this.energyHistory.length<2)return;const s=30,i=e.width-2*s,h=e.height-2*s;let a=this.energyHistory[0].t,n=this.energyHistory[this.energyHistory.length-1].t,r=Math.min(...this.energyHistory.map(t=>t.E)),o=Math.max(...this.energyHistory.map(t=>t.E));o===r&&(r-=.01,o+=.01);const l=Math.max(n-a,1),c=o-r;t.strokeStyle="#666",t.lineWidth=1,t.beginPath(),t.moveTo(s,e.height-s),t.lineTo(e.width-s,e.height-s),t.moveTo(s,s),t.lineTo(s,e.height-s),t.stroke(),t.strokeStyle=this.color,t.lineWidth=2,t.beginPath(),this.energyHistory.forEach((n,o)=>{const g=s+(n.t-a)/l*i,m=e.height-s-(n.E-r)/c*h;0===o?t.moveTo(g,m):t.lineTo(g,m)}),t.stroke();const g=e.height-s-(this.initialEnergy-r)/c*h;t.strokeStyle="#666",t.setLineDash([5,5]),t.beginPath(),t.moveTo(s,g),t.lineTo(e.width-s,g),t.stroke(),t.setLineDash([]),t.fillStyle="#aaa",t.font="10px Arial",t.textAlign="center",t.fillText("Time (s)",e.width/2,e.height-5),t.save(),t.translate(10,e.height/2),t.rotate(-Math.PI/2),t.fillText("Energy",0,0),t.restore()}reset(){this.theta=Math.PI/4,this.omega=0,this.time=0,this.energyHistory=[],this.initialEnergy=this.energy(this.theta,this.omega)}getEnergyError(){return(this.energy(this.theta,this.omega)-this.initialEnergy)/this.initialEnergy*100}animate(){try{this.ctx&&this.energyCtx&&(this.step(),this.draw())}catch(t){console.warn("Animation error:",t)}requestAnimationFrame(()=>this.animate())}}class ComparisonSim{constructor(){this.canvas=document.getElementById("comparison-canvas"),this.energyCanvas=document.getElementById("comparison-energy"),this.canvas&&this.energyCanvas?(this.ctx=this.canvas.getContext("2d"),this.energyCtx=this.energyCanvas.getContext("2d"),this.ctx&&this.energyCtx?(this.L=1,this.g=9.81,this.h=.01,this.theta0=Math.PI/4,this.selectedIntegrator="symplectic",this.running=!0,this.states={euler:{theta:this.theta0,omega:0},symplectic:{theta:this.theta0,omega:0},verlet:{theta:this.theta0,omega:0},rk4:{theta:this.theta0,omega:0}},this.energyHistory={euler:[],symplectic:[],verlet:[],rk4:[]},this.colors={euler:"#ef4444",symplectic:"#22c55e",verlet:"#3b82f6",rk4:"#a855f7"},this.time=0,this.initialEnergy=this.energy(this.theta0,0),this.maxSamples=400,this.setupControls(),this.animate()):console.warn("Failed to get 2D context for comparison canvases")):console.warn("Comparison canvas elements not found")}setupControls(){document.getElementById("comparison-play-pause").addEventListener("click",()=>{this.running=!this.running,document.getElementById("comparison-play-pause").textContent=this.running?"Pause":"Play"}),document.getElementById("comparison-reset").addEventListener("click",()=>{this.reset()}),document.getElementById("comparison-select").addEventListener("change",t=>{this.selectedIntegrator=t.target.value}),document.getElementById("comparison-angle-slider").addEventListener("input",t=>{this.theta0=parseFloat(t.target.value)*Math.PI/180,document.getElementById("comparison-angle").textContent=t.target.value,this.reset()}),document.getElementById("comparison-timestep-slider").addEventListener("input",t=>{this.h=parseFloat(t.target.value)/1e3,document.getElementById("comparison-timestep").textContent=t.target.value})}acceleration(t){return-this.g/this.L*Math.sin(t)}energy(t,e){return this.g*this.L*(1-Math.cos(t))+this.L*this.L*.5*e*e}step(){if(!this.running)return;const t=this.states.euler,e=this.acceleration(t.theta);this.states.euler={theta:t.theta+this.h*t.omega,omega:t.omega+this.h*e};const s=this.states.symplectic,i=s.omega+this.h*this.acceleration(s.theta);this.states.symplectic={theta:s.theta+this.h*i,omega:i};const h=this.states.verlet,a=this.acceleration(h.theta),n=h.omega+.5*this.h*a,r=h.theta+this.h*n,o=this.acceleration(r);this.states.verlet={theta:r,omega:n+.5*this.h*o};const l=this.states.rk4,c=(t,e)=>[e,this.acceleration(t)],g=c(l.theta,l.omega),m=c(l.theta+.5*this.h*g[0],l.omega+.5*this.h*g[1]),y=c(l.theta+.5*this.h*m[0],l.omega+.5*this.h*m[1]),d=c(l.theta+this.h*y[0],l.omega+this.h*y[1]);this.states.rk4={theta:l.theta+this.h/6*(g[0]+2*m[0]+2*y[0]+d[0]),omega:l.omega+this.h/6*(g[1]+2*m[1]+2*y[1]+d[1])},this.time+=this.h,Math.floor(50*this.time)%3==0&&Object.keys(this.states).forEach(t=>{const e=this.energy(this.states[t].theta,this.states[t].omega);this.energyHistory[t].push({t:this.time,E:e}),this.energyHistory[t].length>this.maxSamples&&this.energyHistory[t].shift()}),this.updateStatus()}updateStatus(){document.getElementById("comparison-time").textContent=this.time.toFixed(2),Object.keys(this.states).forEach(t=>{const e=(this.energy(this.states[t].theta,this.states[t].omega)-this.initialEnergy)/this.initialEnergy*100;document.getElementById(`comparison-${t}-error`).textContent=e.toFixed(2)})}draw(){this.drawPendulum(),this.drawEnergyChart()}drawPendulum(){const t=this.ctx,e=this.canvas,s=.35*Math.min(e.width,e.height),i=e.width/2,h=.2*e.height;t.clearRect(0,0,e.width,e.height);const a=this.states[this.selectedIntegrator],n=i+s*Math.sin(a.theta),r=h+s*Math.cos(a.theta);t.strokeStyle=this.colors[this.selectedIntegrator],t.lineWidth=3,t.beginPath(),t.moveTo(i,h),t.lineTo(n,r),t.stroke(),t.fillStyle="#666",t.beginPath(),t.arc(i,h,5,0,2*Math.PI),t.fill(),t.fillStyle=this.colors[this.selectedIntegrator],t.beginPath(),t.arc(n,r,15,0,2*Math.PI),t.fill(),t.fillStyle="white",t.font="14px Arial",t.textAlign="center";const o={euler:"Explicit Euler",symplectic:"Symplectic Euler",verlet:"Velocity Verlet",rk4:"RK4"};t.fillText(o[this.selectedIntegrator],i,e.height-20)}drawEnergyChart(){const t=this.energyCtx,e=this.energyCanvas;t.clearRect(0,0,e.width,e.height);const s=35,i=e.width-2*s,h=e.height-2*s;let a=1/0,n=-1/0,r=1/0,o=-1/0;if(Object.keys(this.energyHistory).forEach(t=>{const e=this.energyHistory[t];0!==e.length&&e.forEach(t=>{a=Math.min(a,t.t),n=Math.max(n,t.t),r=Math.min(r,t.E),o=Math.max(o,t.E)})}),!isFinite(a))return;const l=Math.max(n-a,1),c=Math.max(o-r,.001);t.strokeStyle="#666",t.lineWidth=1,t.beginPath(),t.moveTo(s,s),t.lineTo(s,e.height-s),t.lineTo(e.width-s,e.height-s),t.stroke(),Object.keys(this.energyHistory).forEach(n=>{const o=this.energyHistory[n];if(o.length<2)return;t.strokeStyle=this.colors[n],t.lineWidth=2,t.beginPath();let g=!0;o.forEach(n=>{const o=s+(n.t-a)/l*i,m=e.height-s-(n.E-r)/c*h;g?(t.moveTo(o,m),g=!1):t.lineTo(o,m)}),t.stroke()}),t.fillStyle="#aaa",t.font="10px Arial",t.textAlign="center",t.fillText("Time (s)",e.width/2,e.height-5),t.save(),t.translate(12,e.height/2),t.rotate(-Math.PI/2),t.fillText("Energy",0,0),t.restore()}reset(){this.time=0,this.initialEnergy=this.energy(this.theta0,0),Object.keys(this.states).forEach(t=>{this.states[t]={theta:this.theta0,omega:0},this.energyHistory[t]=[]})}animate(){try{this.ctx&&this.energyCtx&&(this.step(),this.draw())}catch(t){console.warn("Comparison animation error:",t)}requestAnimationFrame(()=>this.animate())}}class PhaseSpaceSim{constructor(){this.theoryCanvas=document.getElementById("theory-phase-canvas"),this.comparisonCanvas=document.getElementById("comparison-phase-canvas"),this.theoryCanvas&&this.comparisonCanvas?(this.theoryCtx=this.theoryCanvas.getContext("2d"),this.comparisonCtx=this.comparisonCanvas.getContext("2d"),this.theoryCtx&&this.comparisonCtx?(this.L=1,this.g=9.81,this.h=.005,this.speed=1,this.running=!0,this.theta=Math.PI/4,this.omega=0,this.time=0,this.selectedMethod="symplectic",this.states={euler:{theta:this.theta,omega:this.omega,trail:[]},symplectic:{theta:this.theta,omega:this.omega,trail:[]},verlet:{theta:this.theta,omega:this.omega,trail:[]},rk4:{theta:this.theta,omega:this.omega,trail:[]}},this.colors={euler:"#ef4444",symplectic:"#22c55e",verlet:"#3b82f6",rk4:"#a855f7"},this.maxTrailLength=500,this.initialEnergy=this.energy(this.theta,this.omega),this.setupControls(),this.setupCanvasInteraction(),this.animate()):console.warn("Failed to get 2D context for phase space canvases")):console.warn("Phase space canvas elements not found")}setupControls(){document.getElementById("phase-play-pause").addEventListener("click",()=>{this.running=!this.running,document.getElementById("phase-play-pause").textContent=this.running?"Pause":"Play"}),document.getElementById("phase-reset").addEventListener("click",()=>{this.reset()}),document.getElementById("phase-clear").addEventListener("click",()=>{this.clearTrails()}),document.getElementById("phase-method-select").addEventListener("change",t=>{this.selectedMethod=t.target.value}),document.getElementById("phase-timestep-slider").addEventListener("input",t=>{this.h=parseFloat(t.target.value)/1e3,document.getElementById("phase-timestep").textContent=t.target.value}),document.getElementById("phase-speed-slider").addEventListener("input",t=>{this.speed=parseFloat(t.target.value),document.getElementById("phase-speed").textContent=t.target.value})}setupCanvasInteraction(){this.theoryCanvas.addEventListener("click",t=>{const e=this.theoryCanvas.getBoundingClientRect(),s=t.clientX-e.left,i=t.clientY-e.top,h=Math.min(this.theoryCanvas.width,this.theoryCanvas.height),a=this.theoryCanvas.width/2,n=this.theoryCanvas.height/2,r=.35*h,o=(s-a)/r*Math.PI,l=-(i-n)/r*6;Math.abs(o)<=Math.PI&&Math.abs(l)<=6&&this.setInitialConditions(o,l)})}setInitialConditions(t,e){this.theta=t,this.omega=e,this.time=0,this.initialEnergy=this.energy(t,e),Object.keys(this.states).forEach(s=>{this.states[s]={theta:t,omega:e,trail:[]}}),document.getElementById("theory-energy").textContent=this.initialEnergy.toFixed(2)}reset(){this.setInitialConditions(Math.PI/4,0)}clearTrails(){Object.keys(this.states).forEach(t=>{this.states[t].trail=[]})}acceleration(t){return-this.g/this.L*Math.sin(t)}energy(t,e){return this.g*this.L*(1-Math.cos(t))+this.L*this.L*.5*e*e}step(){if(this.running){for(let t=0;t<this.speed;t++){const t=this.states.euler,e=this.acceleration(t.theta);this.states.euler={theta:t.theta+this.h*t.omega,omega:t.omega+this.h*e,trail:t.trail};const s=this.states.symplectic,i=s.omega+this.h*this.acceleration(s.theta);this.states.symplectic={theta:s.theta+this.h*i,omega:i,trail:s.trail};const h=this.states.verlet,a=this.acceleration(h.theta),n=h.omega+.5*this.h*a,r=h.theta+this.h*n,o=this.acceleration(r);this.states.verlet={theta:r,omega:n+.5*this.h*o,trail:h.trail};const l=this.states.rk4,c=(t,e)=>[e,this.acceleration(t)],g=c(l.theta,l.omega),m=c(l.theta+.5*this.h*g[0],l.omega+.5*this.h*g[1]),y=c(l.theta+.5*this.h*m[0],l.omega+.5*this.h*m[1]),d=c(l.theta+this.h*y[0],l.omega+this.h*y[1]);this.states.rk4={theta:l.theta+this.h/6*(g[0]+2*m[0]+2*y[0]+d[0]),omega:l.omega+this.h/6*(g[1]+2*m[1]+2*y[1]+d[1]),trail:l.trail},this.time+=this.h}Math.floor(200*this.time)%2==0&&Object.keys(this.states).forEach(t=>{const e=this.states[t];e.trail.push({theta:e.theta,omega:e.omega}),e.trail.length>this.maxTrailLength&&e.trail.shift()}),this.updateStatus()}}updateStatus(){document.getElementById("phase-time").textContent=this.time.toFixed(2);const t=this.states[this.selectedMethod]||this.states.symplectic;document.getElementById("phase-theta").textContent=t.theta.toFixed(3),document.getElementById("phase-omega").textContent=t.omega.toFixed(3);const e=(this.energy(t.theta,t.omega)-this.initialEnergy)/this.initialEnergy*100;document.getElementById("phase-energy-error").textContent=e.toFixed(2)}drawTheoryPhasePortrait(){const t=this.theoryCtx,e=this.theoryCanvas,s=Math.min(e.width,e.height),i=e.width/2,h=e.height/2,a=.35*s;t.clearRect(0,0,e.width,e.height);[.5,1,2,4,6,8].forEach((e,s)=>{t.strokeStyle=`rgba(100, 100, 100, ${.3+.1*s})`,t.lineWidth=1,t.beginPath();let n=!0;for(let s=-Math.PI;s<=Math.PI;s+=.02){const r=this.g*this.L*(1-Math.cos(s));if(e>r){const o=e-r,l=Math.sqrt(2*o)/this.L,c=i+s/Math.PI*a,g=h-l/6*a;n?(t.moveTo(c,g),n=!1):t.lineTo(c,g)}}t.stroke(),t.beginPath(),n=!0;for(let s=-Math.PI;s<=Math.PI;s+=.02){const r=this.g*this.L*(1-Math.cos(s));if(e>r){const o=e-r,l=-Math.sqrt(2*o)/this.L,c=i+s/Math.PI*a,g=h-l/6*a;n?(t.moveTo(c,g),n=!1):t.lineTo(c,g)}}t.stroke()}),t.strokeStyle="#666",t.lineWidth=2,t.beginPath(),t.moveTo(0,h),t.lineTo(e.width,h),t.moveTo(i,0),t.lineTo(i,e.height),t.stroke();const n=i+this.theta/Math.PI*a,r=h-this.omega/6*a;t.fillStyle="#3b82f6",t.beginPath(),t.arc(n,r,6,0,2*Math.PI),t.fill(),t.fillStyle="#aaa",t.font="12px Arial",t.textAlign="center",t.fillText("\u03b8 (rad)",e.width/2,e.height-10),t.save(),t.translate(10,e.height/2),t.rotate(-Math.PI/2),t.fillText("\u03c9 (rad/s)",0,0),t.restore()}drawComparisonPhaseSpace(){const t=this.comparisonCtx,e=this.comparisonCanvas,s=Math.min(e.width,e.height),i=e.width/2,h=e.height/2,a=.35*s;t.clearRect(0,0,e.width,e.height),t.strokeStyle="#666",t.lineWidth=2,t.beginPath(),t.moveTo(0,h),t.lineTo(e.width,h),t.moveTo(i,0),t.lineTo(i,e.height),t.stroke();const n=this.initialEnergy;t.strokeStyle="rgba(100, 100, 100, 0.3)",t.lineWidth=2,t.setLineDash([5,5]),t.beginPath();let r=!0;for(let e=-Math.PI;e<=Math.PI;e+=.02){const s=this.g*this.L*(1-Math.cos(e));if(n>s){const o=n-s,l=Math.sqrt(2*o)/this.L,c=i+e/Math.PI*a,g=h-l/6*a;r?(t.moveTo(c,g),r=!1):t.lineTo(c,g)}}for(let e=Math.PI;e>=-Math.PI;e-=.02){const s=this.g*this.L*(1-Math.cos(e));if(n>s){const r=n-s,o=-Math.sqrt(2*r)/this.L,l=i+e/Math.PI*a,c=h-o/6*a;t.lineTo(l,c)}}if(t.stroke(),t.setLineDash([]),"all"===this.selectedMethod)Object.keys(this.states).forEach(e=>{const s=this.states[e],n=this.colors[e];s.trail.length>1&&(t.strokeStyle=n+"80",t.lineWidth=1,t.beginPath(),s.trail.forEach((e,s)=>{const n=i+e.theta/Math.PI*a,r=h-e.omega/6*a;0===s?t.moveTo(n,r):t.lineTo(n,r)}),t.stroke());const r=i+s.theta/Math.PI*a,o=h-s.omega/6*a;t.fillStyle=n,t.beginPath(),t.arc(r,o,4,0,2*Math.PI),t.fill()});else{const e=this.states[this.selectedMethod],s=this.colors[this.selectedMethod];e.trail.length>1&&(t.strokeStyle=s,t.lineWidth=2,t.beginPath(),e.trail.forEach((e,s)=>{const n=i+e.theta/Math.PI*a,r=h-e.omega/6*a;0===s?t.moveTo(n,r):t.lineTo(n,r)}),t.stroke());const n=i+e.theta/Math.PI*a,r=h-e.omega/6*a;t.fillStyle=s,t.beginPath(),t.arc(n,r,6,0,2*Math.PI),t.fill()}t.fillStyle="#aaa",t.font="12px Arial",t.textAlign="center",t.fillText("\u03b8 (rad)",e.width/2,e.height-10),t.save(),t.translate(10,e.height/2),t.rotate(-Math.PI/2),t.fillText("\u03c9 (rad/s)",0,0),t.restore()}animate(){try{this.theoryCtx&&this.comparisonCtx&&(this.step(),this.drawTheoryPhasePortrait(),this.drawComparisonPhaseSpace())}catch(t){console.warn("Phase space animation error:",t)}requestAnimationFrame(()=>this.animate())}}document.addEventListener("DOMContentLoaded",()=>{try{let t,e,s,i;document.getElementById("euler-canvas")&&document.getElementById("euler-energy")&&(t=new SinglePendulumSim("euler-canvas","euler-energy","euler","#ef4444")),document.getElementById("symplectic-canvas")&&document.getElementById("symplectic-energy")&&(e=new SinglePendulumSim("symplectic-canvas","symplectic-energy","symplectic","#22c55e")),document.getElementById("verlet-canvas")&&document.getElementById("verlet-energy")&&(s=new SinglePendulumSim("verlet-canvas","verlet-energy","verlet","#3b82f6")),document.getElementById("rk4-canvas")&&document.getElementById("rk4-energy")&&(i=new SinglePendulumSim("rk4-canvas","rk4-energy","rk4","#a855f7"));const h=(t,e)=>{if(t)try{const s=document.getElementById(`${e}-slider`),i=document.getElementById(`${e}-timestep`);s&&i&&s.addEventListener("input",e=>{t.h=parseFloat(e.target.value)/1e3,i.textContent=e.target.value});const h=document.getElementById(`${e}-play-pause`);h&&h.addEventListener("click",()=>{const e=t.togglePause();h.textContent=e?"Pause":"Play"});const a=document.getElementById(`${e}-reset`);a&&a.addEventListener("click",()=>{t.reset()});const n=document.getElementById(`${e}-error`);n&&setInterval(()=>{try{const e=t.getEnergyError();n.textContent=e.toFixed(2)}catch(t){console.warn(`Error updating ${e} display:`,t)}},100)}catch(t){console.warn(`Error setting up controls for ${e}:`,t)}};if(h(t,"euler"),h(e,"symplectic"),h(s,"verlet"),h(i,"rk4"),document.getElementById("comparison-canvas")&&document.getElementById("comparison-energy")){new ComparisonSim}if(document.getElementById("theory-phase-canvas")&&document.getElementById("comparison-phase-canvas"))try{new PhaseSpaceSim}catch(t){console.warn("Error initializing phase space simulation:",t)}if(document.getElementById("realtime-euler-canvas"))try{new RealtimeComparisonSim}catch(t){console.warn("Error initializing real-time comparison simulation:",t)}}catch(t){console.error("Error initializing simulations:",t)}});class RealtimeComparisonSim{constructor(){this.canvases={euler:document.getElementById("realtime-euler-canvas"),symplectic:document.getElementById("realtime-symplectic-canvas"),verlet:document.getElementById("realtime-verlet-canvas"),rk4:document.getElementById("realtime-rk4-canvas")};const t=Object.keys(this.canvases).filter(t=>!this.canvases[t]);t.length>0?console.warn("Missing realtime comparison canvases:",t):(this.contexts={},Object.keys(this.canvases).forEach(t=>{this.canvases[t]&&(this.contexts[t]=this.canvases[t].getContext("2d"),this.contexts[t]||console.warn(`Failed to get 2D context for ${t} canvas`))}),this.energyCanvas=document.getElementById("realtime-energy-chart"),this.energyCtx=this.energyCanvas?.getContext("2d"),this.energyCanvas&&this.energyCtx||console.warn("Realtime energy chart canvas not found or context unavailable"),this.L=1,this.g=9.81,this.h=.01,this.theta0=Math.PI/4,this.running=!0,this.states={euler:{theta:this.theta0,omega:0},symplectic:{theta:this.theta0,omega:0},verlet:{theta:this.theta0,omega:0},rk4:{theta:this.theta0,omega:0}},this.energyHistory={euler:[],symplectic:[],verlet:[],rk4:[]},this.colors={euler:"#ef4444",symplectic:"#22c55e",verlet:"#3b82f6",rk4:"#a855f7"},this.time=0,this.initialEnergy=this.energy(this.theta0,0),this.maxSamples=300,this.setupControls(),this.animate())}setupControls(){document.getElementById("realtime-play-pause")?.addEventListener("click",()=>{this.running=!this.running,document.getElementById("realtime-play-pause").textContent=this.running?"Pause":"Play"}),document.getElementById("realtime-reset")?.addEventListener("click",()=>{this.reset()}),document.getElementById("realtime-sync")?.addEventListener("click",()=>{this.syncMethods()}),document.getElementById("realtime-angle-slider")?.addEventListener("input",t=>{this.theta0=parseFloat(t.target.value)*Math.PI/180,document.getElementById("realtime-angle").textContent=t.target.value,this.reset()}),document.getElementById("realtime-timestep-slider")?.addEventListener("input",t=>{this.h=parseFloat(t.target.value)/1e3,document.getElementById("realtime-timestep").textContent=t.target.value})}syncMethods(){Object.keys(this.states).forEach(t=>{this.states[t]={theta:this.theta0,omega:0},this.energyHistory[t]=[]}),this.time=0,this.initialEnergy=this.energy(this.theta0,0)}reset(){this.theta0=Math.PI/4,this.time=0,this.initialEnergy=this.energy(this.theta0,0),Object.keys(this.states).forEach(t=>{this.states[t]={theta:this.theta0,omega:0},this.energyHistory[t]=[]}),document.getElementById("realtime-angle").textContent="45",document.getElementById("realtime-angle-slider").value="45"}acceleration(t){return-this.g/this.L*Math.sin(t)}energy(t,e){return this.g*this.L*(1-Math.cos(t))+this.L*this.L*.5*e*e}step(){if(!this.running)return;const t=this.states.euler,e=this.acceleration(t.theta);this.states.euler={theta:t.theta+this.h*t.omega,omega:t.omega+this.h*e};const s=this.states.symplectic,i=s.omega+this.h*this.acceleration(s.theta);this.states.symplectic={theta:s.theta+this.h*i,omega:i};const h=this.states.verlet,a=this.acceleration(h.theta),n=h.omega+.5*this.h*a,r=h.theta+this.h*n,o=this.acceleration(r);this.states.verlet={theta:r,omega:n+.5*this.h*o};const l=this.states.rk4,c=(t,e)=>[e,this.acceleration(t)],g=c(l.theta,l.omega),m=c(l.theta+.5*this.h*g[0],l.omega+.5*this.h*g[1]),y=c(l.theta+.5*this.h*m[0],l.omega+.5*this.h*m[1]),d=c(l.theta+this.h*y[0],l.omega+this.h*y[1]);this.states.rk4={theta:l.theta+this.h/6*(g[0]+2*m[0]+2*y[0]+d[0]),omega:l.omega+this.h/6*(g[1]+2*m[1]+2*y[1]+d[1])},this.time+=this.h,Math.floor(50*this.time)%3==0&&Object.keys(this.states).forEach(t=>{const e=this.energy(this.states[t].theta,this.states[t].omega);this.energyHistory[t].push({t:this.time,E:e}),this.energyHistory[t].length>this.maxSamples&&this.energyHistory[t].shift()}),this.updateStatus()}updateStatus(){document.getElementById("realtime-time").textContent=this.time.toFixed(2),Object.keys(this.states).forEach(t=>{const e=(this.energy(this.states[t].theta,this.states[t].omega)-this.initialEnergy)/this.initialEnergy*100;document.getElementById(`realtime-${t}-error`).textContent=e.toFixed(2)})}drawPendulum(t){const e=this.contexts[t],s=this.canvases[t];if(!e||!s)return;const i=.3*Math.min(s.width,s.height),h=s.width/2,a=.25*s.height;e.clearRect(0,0,s.width,s.height);const n=this.states[t],r=h+i*Math.sin(n.theta),o=a+i*Math.cos(n.theta);e.strokeStyle=this.colors[t],e.lineWidth=3,e.beginPath(),e.moveTo(h,a),e.lineTo(r,o),e.stroke(),e.fillStyle="#666",e.beginPath(),e.arc(h,a,4,0,2*Math.PI),e.fill(),e.fillStyle=this.colors[t],e.beginPath(),e.arc(r,o,8,0,2*Math.PI),e.fill();const l=(this.energy(n.theta,n.omega)-this.initialEnergy)/this.initialEnergy*100;e.fillStyle=this.colors[t],e.font="11px Arial",e.textAlign="center",e.fillText(`${l.toFixed(1)}%`,h,s.height-10)}drawEnergyChart(){if(!this.energyCtx||!this.energyCanvas)return;const t=this.energyCtx,e=this.energyCanvas;t.clearRect(0,0,e.width,e.height);const s=40,i=e.width-2*s,h=e.height-2*s;let a=1/0,n=-1/0,r=1/0,o=-1/0;if(Object.keys(this.energyHistory).forEach(t=>{this.energyHistory[t].forEach(t=>{a=Math.min(a,t.t),n=Math.max(n,t.t),r=Math.min(r,t.E),o=Math.max(o,t.E)})}),!isFinite(a))return;const l=Math.max(n-a,1),c=Math.max(o-r,.001);t.strokeStyle="#666",t.lineWidth=1,t.beginPath(),t.moveTo(s,s),t.lineTo(s,e.height-s),t.lineTo(e.width-s,e.height-s),t.stroke();const g=e.height-s-(this.initialEnergy-r)/c*h;t.strokeStyle="#666",t.setLineDash([5,5]),t.beginPath(),t.moveTo(s,g),t.lineTo(e.width-s,g),t.stroke(),t.setLineDash([]),Object.keys(this.energyHistory).forEach(n=>{const o=this.energyHistory[n];if(o.length<2)return;t.strokeStyle=this.colors[n],t.lineWidth=2,t.beginPath();let g=!0;o.forEach(n=>{const o=s+(n.t-a)/l*i,m=e.height-s-(n.E-r)/c*h;g?(t.moveTo(o,m),g=!1):t.lineTo(o,m)}),t.stroke()}),t.fillStyle="#aaa",t.font="12px Arial",t.textAlign="center",t.fillText("Time (s)",e.width/2,e.height-5),t.save(),t.translate(15,e.height/2),t.rotate(-Math.PI/2),t.fillText("Energy",0,0),t.restore()}animate(){try{this.step(),Object.keys(this.canvases).forEach(t=>{this.canvases[t]&&this.contexts[t]&&this.drawPendulum(t)}),this.energyCtx&&this.drawEnergyChart()}catch(t){console.warn("Realtime comparison animation error:",t)}requestAnimationFrame(()=>this.animate())}}</script> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> ¬© Copyright 2025 Saeed Ghorbani. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script async src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script> <script async src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script> <script async src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="/assets/js/common.js"></script> <script defer src="/assets/js/custom_effects.js"></script> <script type="text/javascript">window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0,tags:"ams"},options:{ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}};</script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> </body> </html>