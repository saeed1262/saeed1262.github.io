(()=>{"use strict";function e(){const e=m.getBoundingClientRect(),t=Math.min(window.devicePixelRatio||1,2);m.width=Math.floor(e.width*t),m.height=Math.floor(e.height*t),y.setTransform(t,0,0,t,0,0)}function t(e,t){return Math.random()*(t-e)+e}function n(e){const n=4,o=8;S=new Array(e).fill(0).map(()=>{const e=t(n,o);return{x:t(e+2,P.w-e-2),y:t(e+2,P.h-e-2),vx:t(-60,60),vy:t(-60,60),r:e,hue:Math.floor(t(180,260)),colliding:!1}})}function o(){const e=m.getBoundingClientRect();P.w=e.width,P.h=e.height}function l(e,t){const n=new Map,o=1/t;for(let t=0;t<e.length;t++){const l=e[t],r=Math.floor((l.x-l.r)*o),i=Math.floor((l.y-l.r)*o),d=Math.floor((l.x+l.r)*o),c=Math.floor((l.y+l.r)*o);for(let e=i;e<=c;e++)for(let o=r;o<=d;o++){const l=o+","+e;let r=n.get(l);r||(r=[],n.set(l,r)),r.push(t)}}return n}function r(e,t){const n=l(e,t),o=[],r=new Set,i=[-1,0,1];for(const[e,t]of n.entries()){const[l,d]=e.split(",").map(Number);for(let e of i)for(let c of i){const i=l+c+","+(d+e),a=n.get(i);if(a)for(let e=0;e<t.length;e++)for(let n=0;n<a.length;n++){const l=t[e],i=a[n];if(l>=i)continue;const d=(l<<20)+i;r.has(d)||(r.add(d),o.push([l,i]))}}}return o}function i(e){const t=[],n=e.length;for(let e=0;e<n;e++)for(let o=e+1;o<n;o++)t.push([e,o]);return t}function d(e,t){W=0;let n=0;for(let t of e)t.colliding=!1;for(let o=0;o<t.length;o++){const[l,r]=t[o],i=e[l],d=e[r],c=d.x-i.x,a=d.y-i.y,s=i.r+d.r;W++,c*c+a*a<=s*s&&(i.colliding=d.colliding=!0,n++)}return n}function c(e){const t=F,n=P.w,o=P.h;for(let l of S)l.x+=l.vx*t*e,l.y+=l.vy*t*e,l.x<l.r&&(l.x=l.r,l.vx*=-1),l.x>n-l.r&&(l.x=n-l.r,l.vx*=-1),l.y<l.r&&(l.y=l.r,l.vy*=-1),l.y>o-l.r&&(l.y=o-l.r,l.vy*=-1)}function a(e){if(!w.checked)return;y.save(),y.strokeStyle="rgba(96,165,250,0.15)",y.lineWidth=1;const t=P.w,n=P.h;for(let o=0;o<=t;o+=e)y.beginPath(),y.moveTo(o+.5,0),y.lineTo(o+.5,n),y.stroke();for(let o=0;o<=n;o+=e)y.beginPath(),y.moveTo(0,o+.5),y.lineTo(t,o+.5),y.stroke();y.restore()}function s(){if(y.clearRect(0,0,P.w,P.h),a(L),C&&C.checked&&q.length){y.save(),y.strokeStyle="rgba(148,163,184,0.22)",y.lineWidth=.8;for(let[e,t,n,o]of q)y.beginPath(),y.moveTo(e,t),y.lineTo(n,o),y.stroke();y.restore()}for(let e of S){const t=e.colliding?"hsla(350, 85%, 60%, 0.95)":`hsla(${e.hue}, 70%, 60%, 0.9)`,n=e.colliding?"rgba(239,68,68,0.9)":"rgba(148,163,184,0.6)";y.beginPath(),y.arc(e.x,e.y,e.r,0,2*Math.PI),y.fillStyle=t,y.fill(),y.lineWidth=1.5,y.strokeStyle=n,y.stroke()}}function u(e){A||(A=e);const t=Math.min(.033,(e-A)/1e3);A=e;const n=1/Math.max(t,1e-6);let o;if(R=R?.9*R+.1*n:n,M.checked||c(t),o="hash"===T?r(S,L):i(S),$=o.length,q.length=0,C&&C.checked&&o.length)for(let e=0;e<o.length;e++){const[t,n]=o[e],l=S[t],r=S[n];q.push([l.x,l.y,r.x,r.y])}d(S,o),s(),k.algo.textContent="hash"===T?"Spatial Hash":"Na\xefve",k.count.textContent=String(S.length),k.cell.textContent=`${L} px`,k.pairs.textContent=String($),k.checks.textContent=String(W),k.fps.textContent=Math.round(R).toString(),requestAnimationFrame(u)}function h(){b.count.textContent=E.value,b.cell.textContent=I.value,b.speed.textContent=`${parseFloat(B.value).toFixed(2)}x`.replace(".00",".0")}function g(){n(parseInt(E.value,10)||300)}function f(){o(),e(),g(),h(),v&&(v.hidden=!0),requestAnimationFrame(u)}const m=document.getElementById("hash-viz"),y=m?m.getContext("2d"):null,v=document.getElementById("loading"),p=document.getElementById("noCanvas");if(!m||!y)return v&&(v.hidden=!0),void(p&&(p.hidden=!1));const x=document.getElementById("algo"),E=document.getElementById("count"),I=document.getElementById("cell"),B=document.getElementById("speed"),w=document.getElementById("showGrid"),C=document.getElementById("showCandidates"),M=document.getElementById("pause"),k={algo:document.getElementById("hudAlgo"),count:document.getElementById("hudCount"),cell:document.getElementById("hudCell"),pairs:document.getElementById("hudPairs"),checks:document.getElementById("hudChecks"),fps:document.getElementById("hudFps")},b={count:document.getElementById("countLabel"),cell:document.getElementById("cellLabel"),speed:document.getElementById("speedLabel")};window.addEventListener("resize",e,{passive:!0});let S=[],L=parseInt(I.value,10)||32,T=x.value,F=parseFloat(B.value)||1,P={w:1280,h:720},A=0,R=0,W=0,$=0,q=[];x.addEventListener("change",()=>{T=x.value}),E.addEventListener("input",()=>{h(),g()}),I.addEventListener("input",()=>{L=parseInt(I.value,10)||32,h()}),B.addEventListener("input",()=>{F=parseFloat(B.value)||1,h()}),"complete"===document.readyState||"interactive"===document.readyState?setTimeout(f,0):document.addEventListener("DOMContentLoaded",()=>setTimeout(f,0))})();